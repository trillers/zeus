module.exports=function(){var riot=require('seedriot');riot.tag("activity-createsuccess",'<div if="{!hidden}" id="createsuccess_document" class="activity-createsuccess"> <div><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/c_01.png"></div> <div><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/c_02.png"></div> <div class="t-c"> 提示 </div> <div class="t-c" > 已发布的活动可以在“我的活动”中查看和管理。 </div> <div class="footer_placeholder clear"></div> <div class="footer"> <div onclick="{homepage}"></div> <div class="button but2" style="width:36%;" onclick="{jumpActivitypPage}">查看活动</div> <div class="button but2" style="width:36%;" onclick="{jumpNewPage}">发布活动</div> </div> </div>',function(){var i=nest.presentable(this);i.env=__app.settings.env.NODE_ENV;var t=nest.modelable({},{url:__app.settings.api.url+"/pa/"});t._id=this._id=this.opts._id,t.on("fetch",function(t){console.info("activity is fetched"),i.item=t,i.picshow=util.calcImageUrl(i.item),i.update(),s()}),this.showFootterNav=function(i){$(i.target).toggleClass("footer_navs_but_hover");var t=$(i.target).attr("class");t.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(200):$(".footer_navs_wary").slideDown(200),i.stopPropagation()}.bind(this);var e=function(i){this.trigger("ready",!1),this.update(),this.trigger("ready",!0),this.trigger("view-route-to"),console.log(i),console.log(this._id),this._id=i||this._id,t.set("_id",this._id),t.fetch({action:"open"})}.bind(i),o=function(){this.trigger("ready",!1),t.fetch(this._id,{action:"refresh"})}.bind(i);this.on("open",function(i){console.log(i),console.info("tag activities is opening"),e(i),$(window).scrollTop("0px")}),this.on("mount",function(){console.info("tag activities is mounted")}),this.on("refresh",function(){console.info("tag activity is refreshing"),o()}),this.homepage=function(){riot.route("activity/index")}.bind(this),this.jumpNewPage=function(){riot.route("activity/new")}.bind(this),this.jumpActivitypPage=function(){riot.route("activity/_"+t._id)}.bind(this);var s=function(){var e=util.sharepic(i.item);$("#createsuccess_document").off("click").on("click",function(){$(".footer_navs_wary").slideUp(),$(".footer_navs_but").removeClass("footer_navs_but_hover")}),wx.ready(function(){var o={title:i.item.name,desc:i.item.desc,link:__page.holder().getBaseUrl()+"/index#activity/_"+t._id,imgUrl:e};wx.onMenuShareAppMessage(o);var s={title:i.item.name,desc:i.item.desc,link:__page.holder().getBaseUrl()+"/index#activity/_"+t._id,imgUrl:e,success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.VIEW+")",i.item.name||"",util.convertToValue(i.item.tags.type).join(",")||""])}};wx.onMenuShareTimeline(s)})};$(window).scrollTop("0px")});
riot.tag("activity-detail",'<div class="view" if="{!hidden}" id="detail_document"> <mask-loading show="{mask}"></mask-loading> <div class="view" if="{!mask}"> <div if="{debug}"> <a href="#activity/index">返回</a> <a onclick="{refresh}" href="">刷新</a> <a href="#debug/index">调试</a> </div> <div class="activity-detail-banner"> <img riot-src="{picshow}"> <div> <p class="font-size_{status1 ? status1 : \'\'}">{statusName}</p> <span><i>{num ? num :\'0\'}</i></span>人 </div> </div> <div class="activity-detail-title"> <div> <div>{item.name.length > 28 ? item.name.substring(0, 28)+\'...\':item.name}</div> <ul><li each="{name,i in item.tags.type || []}">{__app.enums.TypeTags.values[name]}</li></ul> </div> <div onclick="{likeActivity}"> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/{isActivityLike ? \'x_1\':\'x_2\'}.png" class="vertical"> <span class="likesum">{likes}</span> </div> </div> <div class="activity-detail-basic-info"> <div> <div><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/1_04.png"></div> <div> <p>活动时间</p> <p>{timeString}</p> <p>报名截止 {closingTimeString}</p> </div> </div> <div> <div><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/1_05.png"></div> <div> <p>活动地点</p> <p>{item.place}</p> </div> </div> <div> <div><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/1_06.png"></div> <div> <p>发起人</p> <p><img riot-src="{initiatorHeadUrl}" width="32" class="imgradius vertical"> <span id="initiatorNameinitiatorContacts"></span></p> </div> </div> <p class=" immediately" if="{status1==\'a\'}">我要报名</p> </div> <div class="acrivity_Introduction_nav"> <div class="activity_title"> <span></span> 活动介绍 </div> </div> <div id="ac_detail" class="activity-detail-introduce">  </div> <div class="activity-detail-nav" onclick="{operationNav}">  <div class="{(currentIndex == 2) ? \'checked\' : \'\'}" alt="2">队友</div> <div class="{(currentIndex == 1) ? \'checked\' : \'\'}" alt="1">咨询</div> <div class="{(currentIndex == 3) ? \'checked\' : \'\'}" alt="3" id="random_notes_div1">随记</div> </div> <div class="clear"></div> <div class="activity-detail-applications" id="applications" if="{currentIndex==2}"> <div if="{applicShow === true}" > <div if="{isinitiator == false}"> <applications-item class="no_border" each="{applic}" tag="{this}"></applications-item> </div> <div if="{isinitiator == true}"> <div if="{sms_send == 0}"> <applications-item-initiator class="no_border" each="{applic}" tag="{this}"></applications-item-initiator> </div> <div if="{sms_send == 1}"> <form> <div class="check_all" onclick="{allSelect}"><p if="{selectbut == true}">全选</p><p if="{selectbut == false}">取消全选</p></div> <applications-item-initiator-sms class="no_border" each="{applic}" tag="{this}"></applications-item-initiator-sms> </form> </div> </div> </div> <div class="no-content" if="{applicShow === false}"> 没人报名，赶快去抢沙发吧~~~ </div>  </div> <div class="activity-detail-communication" if="{currentIndex==1}"> <div if="{cmtShow === true}"> <communication-index class="no_border" each="{comments}" tag="{this}"></communication-index> </div> <div class="no-content" if="{cmtShow === false}"> 没有内容，你来发表第一条吧~~~ </div> </div> <div class="activity-detail-randomnotes" if="{currentIndex==3}"> <randomnotes-item class="no_border" each="{randomNotes}" tag="{this}"></randomnotes-item> <div class="no-content" if="{randomNoteShow === false}"> 空空如也，你也来晒晒图吧~~~ </div> </div> <div class="activity-detail-recommend-title"> <div> <span></span> 相关推荐 </div> </div> <div> <activity-recommend-item each="{items}" curritem="{this}"></activity-recommend-item> </div> <div class="clear"></div> <div class="two_dimension_botder-top"></div> <div class="two_dimension"> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/two_dimension.png"> </div> <div class="clear"></div> <div class="serv t-c" id="detail_serv"> <p>使用过程中如有任何疑问请咨询客服</p> <p class="m_top10_media p2"><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/1_19.png"> 客服电话：400-680-9072</p> </div>  <div class="apply_wary activity-detail-apply"> <img src="/web/images/bmwhole.png" class="applyclosebtn_img"> <div id="applyclosebtn" onclick="{closeApplyLayer}" ></div> <div> <p if="{fieldIfExist(\'displayName\')}"><span class="vertical set_line_height26">姓名: </span><input type="text" class="userinfo" name="displayName" value="{contact.displayName}" id="displayName" placeholder="" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'phone\')}"><span class="vertical set_line_height26">手机: </span><input type="tel" class="userinfo" name="phone" id="phone" placeholder="" value="{contact.phone}" onclick="{preventEvent}"></p> <div if="{fieldIfExist(\'gender\')}"> <span class="vertical">性别: </span> <div class="{(contact.gender && contact.gender == \'1\') ? \'sex right1 checked\' : \'sex right1\'}" onclick="{sexSelect}" value="1">女</div> <div class="{(contact.gender && contact.gender == \'1\') ? \'sex right2\' : \'sex right2 checked\'}" onclick="{sexSelect}" value="0">男</div> <input name="gender" type="hidden" id="gender" value="{contact.gender || 0}"> </div> <div class="date_of_birth" if="{fieldIfExist(\'birthday\')}"> <span class="vertical">出生日期:</span> <input type="text" id="birthdayTxt" value="" readonly="readonly" class="userinfo textw1" style="width:70%;"> <input id="birthday" onchange="{birthdayChange}" onclick="{birthdayClick}" onblur="{birthdayBlur}" name="birthday" style="display: inline-block;margin-top:0px;width:70%;" type="date"> <p>请选择 </p> </div> <p if="{fieldIfExist(\'IDCard\')}"><span class="vertical set_line_height26">身份证: </span><input type="text" class="userinfo" name="IDCard" id="IDCard" placeholder="" value="{contact.IDCard}" onclick="{preventEvent}" style="width:75%;"></p> <p if="{fieldIfExist(\'company\')}"><span class="vertical set_line_height26">单位: </span><input type="text" class="userinfo" name="company" id="company" placeholder="" value="{contact.company}" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'position\')}"><span class="vertical set_line_height26">职位: </span><input type="text" class="userinfo" name="position" id="position" placeholder="" value="{contact.position}" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'business\')}"><span class="vertical set_line_height26">行业: </span><input type="text" class="userinfo" name="business" id="business" placeholder="" value="{contact.business}" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'school\')}"><span class="vertical set_line_height26">学校: </span><input type="text" class="userinfo" name="school" id="school" placeholder="" value="{contact.school}" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'discipline\')}"><span class="vertical set_line_height26">专业: </span><input type="text" class="userinfo" name="discipline" id="discipline" placeholder="" value="{contact.discipline}" onclick="{preventEvent}"></p> <p if="{fieldIfExist(\'class\')}"><span class="vertical set_line_height26">班级: </span><input type="text" class="userinfo" name="class" id="class" placeholder="" value="{contact.class}" onclick="{preventEvent}"></p> <div class="number_of_people"> <span class="vertical">人数: </span> <div value="+" class="add" id="add1" >+</div> <input type="text" class="sum_info" value="1" name="num" id="num" readonly><div value="-" class="minus" id="minus1" >-</div> </div> <input name="applicant" type="hidden" id="applicant" value="" class="userinfo"> <div class="message" if="{fieldIfExist(\'desc\')}"> <table class=""> <tr> <td valign="top" width="35"><span >备注: </span></td> <td valign="top"> <textarea name="desc" id="desc" placeholder="" class="textarea1" onclick="{preventEvent}" rows="2" ></textarea></td> </tr> </table> </div> <p class="presentation">以上信息仅活动发起人可见，不会透露给其他人</p> <div id="applyaddbtn" >提 交</div> </div> <div class="applysubbtn"></div> </div> <div class="body_shadow display_none"></div>  <div class="footer_placeholder clear"></div> <div class="footer" name="btnbox"> <div onclick="{returnPage}"></div> <div class="but1 star_undo button {isActivityStar ? \'star\':\'\'}" onclick="{activityStar}" if="{menu(status1,isinitiator,currentIndex,num).actions.star()}"></div> <div class="recall_but1 button but1" if="{menu(status1,isinitiator,currentIndex,num).actions.recall()}">撤回</div> <div class="button but1" onclick="{editpa}" if="{menu(status1,isinitiator,currentIndex,num).actions.modify()}">修改</div>  <div class="button but1_export" if="{menu(status1,isinitiator,currentIndex,num).actions.export() && sms_send == 0}" onclick="{showSendmail}">导出名单</div> <div class="button but1" onclick="{cancelSend}" if="{menu(status1,isinitiator,currentIndex,num).actions.smsSend() && sms_send == 1}">取消</div> <div class="button butmasstexting" if="{menu(status1,isinitiator,currentIndex,num).actions.massTexting() && sms_send == 0}" onclick="{addSend}">群发短信</div> <a href="#" onclick="javascript:var errorarr = []; errorarr.push(\'请选择要发送的队友\'); util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;" class="send" if="{menu(status1,isinitiator,currentIndex,num).actions.smsSend() && sms_send == 1}"><div class="button but2">发送</div></a>  <div class="immediately button but2 {(menu(status1,isinitiator,currentIndex,num).len==0) ? \'randomnote\' : \'\'} {(menu(status1,isinitiator,currentIndex,num).len==3) ? \'butmasstexting_width1\' : \'\'} {(menu(status1,isinitiator,currentIndex,num).len==1) ? \'publish_width1\' : \'\'}" if="{menu(status1,isinitiator,currentIndex,sms_send).actions.application()}">我要报名</div>  <div class="release_but1 button but2" if="{menu(status1,isinitiator,currentIndex,num).actions.modify()}">立即发布</div>  <div class="button randomnote" onclick="{addRandomNote}" if="{menu(status1,isinitiator,currentIndex,num).actions.randomNote()}">添加随记</div>  <div class="button publish {(menu(status1,isinitiator,currentIndex,num).len==2) ? \'publish_width1\' : \'\'} {(menu(status1,isinitiator,currentIndex,num).len==3) ? \'publish_width1\' : \'\'} {(menu(status1,isinitiator,currentIndex,num).len == 4) ? \'butmasstexting_width1\' : \'\'}" onclick="{showattention_by_publish}" if="{menu(status1,isinitiator,currentIndex,num).actions.publish()}">发布活动</div>  <div class="interflow_footer" if="{menu(status1,isinitiator,currentIndex,consult).actions.comment()}"> <input type="text" name="interflow_content" id="interflow_content" placeholder="说说你的想法..." onclick="{interruptedBubbling}" value=""> <span onclick="{addComment}">发送</span> </div> <div class="interflow_footer" if="{menu(status1,isinitiator,currentIndex,consult).actions.replyComments()}"> <input type="text" name="interflow_reply" id="interflow_reply" placeholder="" onclick="{interruptedBubbling}"> <span onclick="{replyComment}">发送</span> </div> </div> </div> <div class="body_shadow_pull display_none" onclick="{hideBodyShadowAll_detail}"></div> <div class="wechat-concern display_none"> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/closebtn2.png" class="closebtn2" onclick="{hideBodyShadowAll_detail}"> <p class="t-c inde_font">关注“快乐种子”后，可以接收活动<br>提醒和使用其他更多服务！</p> <div if="{!fromButtonClick}"> <div class="but_left fl t-c" onclick="{openWxhref}">关注，支持一下</div> <div class="but_right fl t-c" onclick="{hideBodyShadowAll_detail}">残忍拒绝:(</div> </div> <button class="atten_but border_radius" onclick="{openWxhref}" if="{fromButtonClick}">立即关注</button> </div> <div class="together display_none together_detail" id="clickXHidden" onclick="{hideBodyShadowAll_detail}"> <img src="/public/images/shareInfo1.png" class="together_img"> </div> <div class="sendmail"> <input type="email" name="mailboxName" value="{contact.email}" id="mailboxName" placeholder="请输入您的邮箱"> <div onclick="{exportmail}">发送到邮箱</div> <div onclick="{hideBodyShadowAll_detail}">取消</div> </div> </div>',"activity-detail { } activity-detail input{ background:transparent; } activity-detail .typetagsul{ } activity-detail .typetagsul li{ float: left;line-height:18px; } activity-detail .imgPreviewer ul li{ float:left; }",function(){function t(){var t,i,e,n=p.guest,a=p.randomNotes;for(t=0,i=a.length;i>t;t+=1)if(a[t]._id===n){e=a[t],e&&e.pics&&e.pics.length>0&&util.wedgt.imgPreviewer($("#wary"),e.pics,{msg:e.desc});break}}function i(){if(p.randomNotes[0]){var t=p.randomNotes[0];wx.ready(function(){var i,e,n,a,s=t,o=p;if(p.shareinfo_detail(),s&&s.pics[0]&&s.pics[0]){var c={};c.images=[],c.images[0]={meta:s.pics[0].meta,url:s.pics[0].url},i="http://"+util.sharepic(c)}else i="/public/images/pabanner.png";e={title:'我在参加"'+o.item.name+'"活动,给小伙伴直播一下~~~~',desc:s.desc||o.item.name,link:__page.holder().getBaseUrl()+"/index#activity/_"+o._id+"?guest="+t._id,imgUrl:i},n=Object.create(e),n.success=function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",o.item.name||"",util.convertToValue(o.item.tags.type).join(",")||"",0])},a=Object.create(e),a.success=function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",o.item.name||"",util.convertToValue(o.item.tags.type).join(",")||"",0])},wx.onMenuShareAppMessage(n),wx.onMenuShareTimeline(a)})}}function e(){$(".body_shadow").hide(),$(".apply_wary").hide()}function n(){$("#num").attr("value",1),document.getElementById("desc")&&(document.getElementById("desc").value="")}function a(){for(var t={},i=p.applicationFields,e=0;e<i.length;e++)t[i[e].name]=document.getElementById(i[e].name).value;return t.applicant=p.userId,t.num=document.getElementById("num").value,t}function s(){for(var t=a(),i=[],e=util.validator(),n=Object.keys(t),s=0;s<n.length;s++)switch(n[s]){case"displayName":e.empty(t.displayName)&&i.push("请输入姓名！");break;case"phone":e.empty(t.phone)&&i.push("请输入电话号码！");break;case"birthday":e.empty(t.birthday)&&i.push("请输入出生日期！");break;case"IDCard":e.empty(t.IDCard)&&i.push("请输入身份证号码！");break;case"company":e.empty(t.company)&&i.push("请输入单位名称！");break;case"position":e.empty(t.position)&&i.push("请输入职位名称！");break;case"business":e.empty(t.business)&&i.push("请输入行业名称！");break;case"school":e.empty(t.school)&&i.push("请输入学校！");break;case"class":e.empty(t.class)&&i.push("请输入班级！");break;case"discipline":e.empty(t.discipline)&&i.push("请输入专业名称！")}return i.length>0?(i.pop(),!1):(h.execute({id:p.id,temp:t}),void 0)}function o(){p.subscribe||void 0==util.getCookie("showAttentionPrompt")&&(showattention_detail(),util.setCookie("showAttentionPrompt","true",1))}function c(){$(".body_shadow_pull").hide(),$(".wechat-concern").hide(),$(".together_detail").hide(),$(".sendmail").hide()}function l(t){var i="add"+t,e="minus"+t,n="num";$("#"+i).off("click"),$("#"+i).click(function(){var t=Number($("#"+n).attr("value"));$("#"+n).attr("value",++t),console.info("+="+t)}),$("#"+e).off("click"),$("#"+e).click(function(){var t=Number($("#"+n).attr("value"));t>1?$("#"+n).attr("value",--t):$("#"+n).attr("value",t),console.info("-="+t)})}function r(){$("#interflow_content").blur(),$("#interflow_reply").blur(),$(".communication-index").parent().removeClass("com_wary_background_color"),p.consult=0,p.update()}function d(t){v.execute(p.id,t)}var u=this.app=this.opts.app,p=nest.presentable(this),m=domain.action("sendMailActivities"),h=domain.action("applyActivity"),v=domain.action("modifyStatusActivities"),f=domain.action("loadContact"),g=domain.action("replyActivity"),_=domain.action("applicantLoadMore");p.env=__app.settings.env.NODE_ENV,p.debug=__app.settings.env.debug,p.menu=function(t,i,e,n){var a=this,s=0,t=util.events._valueToKey(__app.enums.ProductActivityStatus.names)[t],o=__page.browser.Android;a.actions={publish:function(){return("Ready"===t||"Completed"===t||"Acting"==t||"Reviewing"===t||"Draft"==t||"Cancelled"==t&&!i)&&(0==e||2==e)},randomNote:function(){return 3==e},comment:function(){return 1==e&&0==n},replyComments:function(){return 1==e&&1==n},modify:function(){return("Draft"==t||"Cancelled"==t)&&i&&(0==e||2==e)},recall:function(){return"Applying"==t&&i&&0==n&&(0==e||2==e)},application:function(){return"Applying"==t&&(0==e||2==e)&&0==n},star:function(){return("Ready"===t||"Completed"===t||"Acting"==t||"Applying"==t)&&(!i||n>0)&&(0==e||2==e&&!i)},massTexting:function(){return"Draft"!=t&&o&&i&&2==e&&n>0},"export":function(){return"Draft"!=t&&i&&2==e&&n>0},smsSend:function(){return"Draft"!=t&&o&&i&&2==e&&n>0}};for(var c in a.actions)a.actions[c]()&&s++;return{len:s,actions:a.actions}};var y="";y=null==__page.user.displayName?"":"匿名"==__page.user.displayName?"":__page.user.displayName,p.contact={displayName:y},p.dName=y,p.subscribe=!0,p.wxhref=util.getWxhref(),p.fromButtonClick=!1;var b=domain.action("likeActivity"),w=domain.action("starActivity"),k=domain.action("commentActivity"),x=nest.modelable({},{url:__app.settings.api.url+"/pa/"}),I={sort:{priorityRank:-1,statusrank:1,startTime:1},page:{size:5,no:1},conditions:{status:{$in:["a","re","ac","co"]},reviewStatus:{$in:["t","d"]},"tags.type":{},privateFlag:!1}};__page.tenant&&(I.conditions.tenantId=__page.tenant);var A=this.collection=nest.collectable({},{url:__app.settings.api.url+"/pa/find",filter:I});__page.tenant&&(I.conditions.tenantId=__page.tenant),A.on("fetch",function(t){for(var i=t.length,e=!1,n=0;i>n;n++)if(t[n]._id==p._id){t.splice(n,1),e=!0;break}e||t.pop(),p.update({items:t})}),p.footershow=!0,x._id=this._id=this.opts._id,x.on("fetch",function(n){console.info("activity is fetched"),p.item=n,p.num=z(n),p.highlightsArray=O(n.desc.split("\n")),p.applic=j(n.applications),p.randomNotes=n.randomNotes?n.randomNotes:"",p.cmt=n.comments,p.status1=n.status,p.reviewStatus=n.reviewStatus,p.applicShow=p.applic.length?!0:!1,p.applicLoadMoreShow=n.applications.length>10?!0:!1,p.randomNoteShow=p.randomNotes.length?!0:!1,p.cmtShow=p.cmt.length?!0:!1,p.id=n._id,p._comments=n.comments,N(),p.userId=window.__page.user.id,p.replyTo="",p.replyToName="",p.initiator=n.initiator,p.picshow=util.calcImageUrl(p.item),p.startTime=util.dateFormat(new Date(n.startTime),"yyyy/MM/dd"),p.startTime_Week=util.getDateWeek(new Date(n.startTime)),p.endTime=util.dateFormat(new Date(n.endTime),"yyyy/MM/dd"),p.endTime_Week=util.getDateWeek(new Date(n.endTime)),p.closingTime=util.dateFormat(new Date(n.closingTime),"yyyy/MM/dd"),p.closingTime_Week=util.getDateWeek(new Date(n.closingTime)),p.timeString=p.endTime==p.startTime?p.startTime+" "+p.startTime_Week:p.startTime+" "+p.startTime_Week+" - "+p.endTime+" "+p.endTime_Week,p.closingTimeString=p.closingTime+" "+p.closingTime_Week,p.likes=n.meta.likes,p.stars=n.meta.stars,p.applicationFields=n.applicationFields,p.isinitiator=p.userId==p.initiator?!0:!1,p.currentIndex=2,p.consult=0,p.sms_send=0,p.isActivityLike=__page.user.meta.pa.likes[p.id],p.isActivityStar=__page.user.meta.pa.stars[p.id],p.statusName="r"==p.reviewStatus?__app.enums.ReviewStatus.values[p.reviewStatus]:__app.enums.ProductActivityStatus.values[p.status1],p.selectbut=!0,p.initiatorNameinitiatorContact=p.item.initiatorName+" "+p.item.initiatorContact,p.initiatorHeadUrl=p.item.userforHeadUrl.headImgUrl?p.item.userforHeadUrl.headImgUrl:"/public/images/head.png",p.update(),p.trigger("ready",!0),p.trigger("view-route-to"),J(util.replaceImgTemplate(n.desc)),$("#initiatorNameinitiatorContacts").text(p.initiatorNameinitiatorContact),R(),K(),H(),"true"===p.shareflag&&i(),p.guest?(p.currentIndex=3,p.update(),"true"!=p.guest&&t()):$(window).scrollTop(0),o(),console.log("cookie "+util.getCookie("applicants")),e()});var T={page:{size:10,no:1},finish:!1};this.applicantFetch=function(){0==T.finish&&_.execute(p.id,T)}.bind(this);var S=function(t){t.length>=T.page.size?(T.page.no++,T.finish=!1):T.finish=!0,p.update({applic:j(t)})};p.fieldIfExist=function(t){for(var i=!1,e=0,n=p.applicationFields.length;n>e;e++)if(p.applicationFields[e].name==t){i=!0;break}return i},this.editpa=function(){riot.route("activity/edit/_"+p.id)}.bind(this),this.exportmail=function(){var t=this._id,i=$("#mailboxName").val().trim(),e=p.item.name,n=/^.+@.+\..{2,3}$/;return n.test(i)?(m.execute({id:t,mailboxName:i,name:e}),void 0):util.tipssuccess(1,"邮箱格式错误",1)}.bind(this);var N=function(){var t=p._comments.length;p.comments=[];for(var i=0;t>i;i++)"r"!=p._comments[i].reviewStatus&&p.comments.push(p._comments[i])},D=function(t){this.trigger("ready",!1),p.shareflag=t.share,p.guest=t.guest||null,this._id=t.id||this._id,x.set("_id",this._id),x.fetch({action:"open"}),A.fetch()}.bind(p),C=function(){this.trigger("ready",!1),x.fetch(this._id,{action:"refresh"})}.bind(p),E=function(t){p.isActivityLike||(t>p.likes?(_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.COLLECT+")",p.item.name||"",util.convertToValue(p.item.tags.type).join(",")||"",t.result]),p.isActivityLike=!0,__page.user.meta.pa.likes[p.id]=(new Date).getTime()):(p.isActivityLike=!1,delete __page.user.meta.pa.likes[p.id]),p.likes=t,p.update())},M=function(t){t>p.stars?(_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.LIKES+")",p.item.name||"",util.convertToValue(p.item.tags.type).join(",")||"",t]),p.isActivityStar=!0,util.tipssuccess(0,"收藏成功!",1),__page.user.meta.pa.stars[p.id]=(new Date).getTime()):(p.isActivityStar=!1,delete __page.user.meta.pa.stars[p.id]),p.stars=t,p.update()},P=function(t){$("#interflow_content").val(""),$("#interflow_content").attr("placeholder","说说你的想法..."),p.comments=t,p.cmtShow=p.comments.length?!0:!1,p.update()},B=function(t){$("#interflow_content").val(""),$("#interflow_content").attr("placeholder","说说你的想法..."),p.comments=t,p.cmtShow=p.comments.length?!0:!1,p.update()},U=function(){util.tipssuccess(0,"邮件已发送！",1),c()},F=function(t){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.APPLICATE+")",p.item.name||"",util.convertToValue(p.item.tags.type).join(",")||"",t.length]),util.tipssuccess(0,"报名成功",1),p.applic=j(t),p.applicShow=p.applic.length?!0:!1;for(var i=0,a=0;a<p.applic.length;a++)i+=p.applic[a].num;p.num=i,p.update(),e(),n()},W=function(){var t=this.inputs[1];"recall"==t&&util.tipssuccess(0,"撤回成功!",1),"recall"==t?x.fetch():riot.route("activity/createsuccess/_"+p.id)},L=function(){var t=this.inputs[1],i=[];"recall"==t?i.push("撤回失败!"):"publish"==t&&i.push("发布失败!"),util.tipssuccess(1,i[i.length-1],1),i.pop()};this.on("mount",function(){console.info("tag activity is mounted"),b.onDone(E),w.onDone(M),g.onDone(P),k.onDone(B),m.onDone(U),h.onDone(F),_.onDone(S),v.onDone(W),v.onFail(L)}),this.on("unmount",function(){console.info("tag activity is mounted"),b.offDone(E),w.offDone(M),g.offDone(P),k.offDone(B),m.offDone(U),h.offDone(F),_.offDone(S),v.offDone(W),v.offFail(L)}),this.on("leave",function(){util.wedgt.imgPreviewer.refresh($("#wary"))}),this.on("open",function(t){console.info("tag activity is opening"),x&&x.fetched()&&H(),D(t)}),this.on("leave",function(){p.mask=!0,p.update()}),this.on("reenter",function(){p.mask=!1,p.update()}),this.on("refresh",function(){console.info("tag activity is refreshing"),C()}),this.on("show",function(t){t&&__page.holder().setTitle(p.item.name),$(window).scrollTop("0px")}),this.refresh=function(){C()}.bind(this);var z=function(t){for(var i=0,e=0;e<t.applications.length;e++)i+=t.applications[e].num;return i},O=function(t){for(var i=0;i<t.length;i++)t[i]&&(t[i]=t[i].replace(/ /g,"&nbsp;"));return t},j=function(t){for(var i=0,e=t.length;e>i;i++)t[i].birthday&&(t[i].birthday=util.dateFormat(new Date(t[i].birthday),"yyyy/MM/dd")),t[i].gender&&(t[i].gender="0"==t[i].gender?"男":"女");return t},R=function(){$(".img_home").click(function(){$(".home_gy").removeClass("home_gy_set1"),$(".home_gy").addClass("home_gy_set")}),$(".home_close").click(function(){$(".home_gy").removeClass("home_gy_set"),$(".home_gy").addClass("home_gy_set1")}),l(1),$(".recall_but1").off("click").on("click",function(){d("recall")}),$(".release_but1").off("click").on("click",function(){d("publish")}),$(".immediately").off("click").on("click",function(){p.fromButtonClick=!0,p.update(),p.subscribe?(Q(),q()):showattention_detail()}),$(".body_shadow").off("click").on("click",function(){}),$("#applyaddbtn").off("click"),$("#applyaddbtn").on("click",function(){s()})},H=function(){var t=util.sharepic(p.item);wx.ready(function(){wx.onMenuShareAppMessage({title:p.item.name,desc:util.htmlParser.parse(p.item.desc),link:__page.holder().getBaseUrl()+"/#activity/_"+x._id,imgUrl:t,type:"",dataUrl:"",success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",p.item.name||"",util.convertToValue(p.item.tags.type).join(",")||"",0])},cancel:function(){}}),wx.onMenuShareTimeline({title:p.item.name,link:__page.holder().getBaseUrl()+"/index#activity/_"+x._id,imgUrl:t,success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",p.item.name||"",util.convertToValue(p.item.tags.type).join(",")||"",1])},cancel:function(){}})})};this.operationNav=function(t){p.currentIndex=$(t.target).attr("alt"),p.update()}.bind(this),this.showFootterNav=function(t){$(t.target).toggleClass("footer_navs_but_hover");var i=$(t.target).attr("class");i.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(100):$(".footer_navs_wary").slideDown(100),t.stopPropagation()}.bind(this),this.showattention_by_publish=function(){p.fromButtonClick=!0,p.subscribe?riot.route("activity/new"):showattention_detail()}.bind(this),this.showattention_detail=function(){var t=$(window).scrollTop(),i=$(window).height(),e=$("body").height(),n=$(".wechat-concern").height()-100,a=i>e?i:e,s=t+i/2-n/2-100;$(".body_shadow_pull").show().css("height",a+"px").css("z-index","699"),$(".wechat-concern").show().css("top",s+"px")}.bind(this);var V=function(){var t=$(window).scrollTop(),i=$(window).height(),e=$("body").height(),n=i>e?i:e;$(".together_detail").show().css("top",t+"px").css("z-index","700"),$(".body_shadow_pull").show().css("height",n+"px").css("z-index","699")};p.shareinfo_detail=V,this.hideBodyShadowAll_detail=function(){$(".body_shadow_pull").hide(),$(".wechat-concern").hide(),$(".together_detail").hide(),$(".sendmail").hide()}.bind(this),this.openWxhref=function(){$(".body_shadow_pull").hide(),$(".wechat-concern").hide(),util.setCookie("attentionUrl","activity/_"+p.id,1),window.location=p.wxhref}.bind(this),this.preventEvent=function(t){t.stopPropagation()}.bind(this),this.likeActivity=function(){p.isActivityLike?util.tipssuccess(0,"已点赞！",1):b.execute(p.id)}.bind(this),this.activityStar=function(){w.execute(p.id)}.bind(this);var q=function(){var t=$(window).scrollTop(),i=$(window).height(),e=$("body").height(),n=$(".apply_wary").height()-100,a=$(".apply_wary").height(),s=i>e?i:e,o=t+i/2-n/2-20;a>i&&(o=10,$(window).scrollTop("0px")),$(".body_shadow").show().css("height",s+"px"),$(".body_shadow_pull").hide(),$(".attention_wary").hide(),$(".apply_wary").show().css("top",o+"px")};this.sexSelect=function(t){$(".sex").removeClass("checked"),$("#gender").val($(t.target).attr("value")),$(t.target).addClass("checked")}.bind(this),this.closeApplyLayer=function(){e(),n()}.bind(this),this.addRandomNote=function(){util.setCookie("detailId",p.id,30),riot.route("activity/add-randomnotes")}.bind(this),this.returnPage=function(){riot.route(u.history.length>0?u.history.pop():"activity/index")}.bind(this),this.changeHeight=function(t){var i=($(t.target)[0].value,$(t.target).width()),e=14*$(t.target)[0].value.length,n=Math.floor(e/i);if(console.log("length: "+$(t.target)[0].value.length),console.log("textWidth: "+i),console.log("infoWidth: "+e),console.log("infoWidth % textWidth: "+n),n>=1){n++;var a=32*n,s=40*n;$(t.target).height(a),$(".footer").height(s),$(".footer_placeholder").height(s),console.log("inputHeight:"+a),console.log("footerHeight:"+s),console.log(n)}}.bind(this),this.showSendmail=function(){Q();var t=$(window).height(),i=$("body").height(),e=t>i?t:i;$(".body_shadow_pull").show().css("height",e+"px").css("z-index","699"),$(".sendmail").show()}.bind(this);var K=function(){$("#detail_document").off("click").on("click",function(){$(".footer_navs_wary").slideUp(),$(".footer_navs_but").removeClass("footer_navs_but_hover"),r()})};this._resetFooterStyle=function(){r()}.bind(this),this._MassTextingURL=function(){for(var t="",i=$(".activity-detail-applications .add_info_checked"),e=$(".send"),n=0,a=i.length;a>n;n++){var s=i[n];t=0==n?$(s).attr("phone"):t+";"+$(s).attr("phone")}""!=t?(e.attr("href","sms:"+t),e.attr("onclick","")):(e.attr("href","#"),e.attr("onclick","javascript:var errorarr = []; errorarr.push('请选择要发送的队友');  util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;"))}.bind(this),this.allSelect=function(){p.selectbut?($(".add_info_checkbox_div1").addClass("add_info_checked"),p.selectbut=!1):($(".add_info_checkbox_div1").removeClass("add_info_checked"),p.selectbut=!0),p.update(),this._MassTextingURL()}.bind(this),this.cancelSend=function(){var t=$(".send");p.sms_send=0,$(".add_info_checkbox_div1").removeClass("add_info_checked"),p.selectbut=!0,p.update(),t.attr("href","#"),t.attr("onclick","javascript:var errorarr = []; errorarr.push('请选择要发送的队友');  util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;")}.bind(this),this.addSend=function(){p.sms_send=1,p.update()}.bind(this),this.interruptedBubbling=function(t){t.stopPropagation()}.bind(this),this.addComment=function(){var t={comment:"",commenter:"",commenterName:"",replyTo:"",replyToName:""};t.comment=document.getElementById("interflow_content").value,t.commenter=p.userId;var i=[],n=util.validator();return n.empty(t.comment)?(util.tipssuccess(1,i[i.length-1],1),!1):(k.execute({id:p.id,data:t}),e(),!0)}.bind(this),this.replyComment=function(){var t={comment:"",commenter:"",commenterName:"",replyTo:"",replyToName:""};t.comment=document.getElementById("interflow_reply").value;var i=[],e=util.validator();if(e.empty(t.comment)&&i.push("请输入回复内容！"),i.length>0)return util.tipssuccess(1,i[i.length-1],1),void 0;var n=":"+t.comment;return t.comment=n,t.commenter=p.userId,t.replyTo=p.replyTo,t.replyToName=p.replyToName,g.execute({id:p.id,data:t}),!0}.bind(this);var X=p.newdate=new Date(__page.servertime);p.on("toabsolute",function(){p.btnbox.style.position="absolute",p.btnbox.style.bottom="0px"}),p.on("tofixed",function(){p.btnbox.style.position="fixed",p.btnbox.style.bottom="0px"});var G=navigator.userAgent;G.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(this.brithdayClick=function(){p.trigger("toabsolute")}.bind(this),this.birthdayBlur=function(){p.trigger("tofixed")}.bind(this)),this.birthdayChange=function(){var t=document.querySelector("#birthday"),i=document.querySelector("#birthdayTxt");return""==t.value&&util.getBrowser().android===!1?(t.value=X,i.value=util.dateFormat(X,"yyyy/MM/dd"),!1):(i.value=util.dateFormat(new Date(t.value),"yyyy/MM/dd"),void 0)}.bind(this);var J=function(t){$("#ac_detail").html(t)},Q=function(){var t=f.newInvocation(__page.user.id);t.onDone(function(t){if(t&&t.contact&&(p.contact=t.contact,p.update(),document.querySelector("#birthday")&&p.contact.birthday)){var i=document.querySelector("#birthday"),e=document.querySelector("#birthdayTxt");i.value=util.dateFormat(new Date(p.contact.birthday),"yyyy-MM-dd"),e.value=util.dateFormat(new Date(p.contact.birthday),"yyyy-MM-dd")}}).execute()}});
riot.tag("activity-edit",' <div id="addactbody" if="{!hidden}"> <div class="activity-new-statement"> <p>提醒：活动内容包含违法、反动信息或者冒用他人/组织的名 义发布活动，平台有权删除其活动并提交公安机关处理</p> <img riot-src="/{env}/images/closebtn3.png" class="closebtn3" onclick="{closeStatement}"> </div> <form id="actform"> <div class="activity-new-basic-info"> <section> <div class="secleft"><img riot-src="/{env}/images/new1.png"></div> <div class="secright"> <input type="text" onfocus="{inputonfocus}" onblur="{inputonblur}" name="name" value="" placeholder=""> </div> </section> <section class="tag-type"> <div class="secleft"><p class="p1"><img riot-src="/{env}/images/new2.png"></p> <p class="p2" onclick="{showSelectType}">类型标签</p></div> <div class="secright"> <ul> <li each="{name,i in typetags}" data="{name}" class="{tagdefault:true,checked:parent.currtypetags.indexOf(name)>=0} {(i==3||i==7)?\'no_m_left\':\'\'}" onclick="{parent.selecttags}"> <i>{__app.enums.TypeTags.values[name]}</i> </li> </ul> </div> </section> <section class="activity-time"> <div class="secleft"><img riot-src="/{env}/images/new3.png"></div> <div class="secright"> <div class="fl div_left">活动时间</div> <div class="fl div_right"> <div id="startTimebtn" class="datediv"> <input type="text" id="startTimetxt" value="00/00" readonly="readonly"> <input id="startTime" onchange="{startchange}" onclick="{dateclick}" onblur="{dateblur}" name="startTime" style="display: inline-block;margin-top:0px;" type="date"> </div> <i style="display:block;position:absolute;top:20px;left:43%;width:20px;height:1px;border-top:1px solid #ccc"></i> <div id="endTimebtn" class="datedivright"> <input type="text" id="endTimetxt" value="00/00" readonly="readonly"> <input id="endTime" onchange="{endchange}" onclick="{dateclick}" onblur="{dateblur}" name="endTime" style="display: inline-block;margin-top:0px" type="date"> </div> </div> </div> </section> <section> <div class="secleft"><img riot-src="/{env}/images/new4.png"></div> <div class="secright"> <div></div> <input type="text" onfocus="{inputonfocus}" onblur="{inputonblur}" name="place" value="" placeholder=""> </div> </section> <section class="initiator"> <div class="secleft"><img riot-src="/{env}/images/new5.png"></div> <div class="secright"> <div class="fl div_left">发起人</div> <div class="fl div_right"> <div style="width:30%;float: left;line-height: 35px;"><input type="text" onfocus="{inputonfocus}" style="font-size:14px;" onblur="{inputonblur}" name="initiatorName" placeholder="姓名"></div> <div style="width:70%;float:right;position:relative;line-height: 35px;"><span class="borderleft"></span><input type="text" onfocus="{inputonfocus}" onblur="{inputonblur}" style="font-size:14px;" name="initiatorContact" placeholder="联系方式"></div> </div> </div> </section> <section class="deadline"> <div class="secleft"><img riot-src="/{env}/images/new6.png"></div> <div class="secright"> <div class="fl div_left">报名截止</div> <div class="fl div_right"> <div class="datediv datediv360"> <input id="closingTimebtn" type="text" attr="closingTime" value="00/00" readonly="readonly"> <input id="closingTime" onchange="{closingchange}" onclick="{dateclick}" onblur="{dateblur}" name="closingTime" style="display: inline-block;" type="date"> </div> </div> </div> </section> </div> <div class="activity-new-activity-introduction-title"> <div class="activity_title"> <span></span> 活动介绍 </div> </div> <div> <div id="editor"></div>               </div> <div class="banner" onclick="{uploadimg}" if="{test}" style="position: relative"> <div style="position: absolute;bottom:10px;right:10px;width:24px;height:24px;z-index: 100;"> <img style="width:24px;height:24px" riot-src="/{env}/images/5.0.8.png"> </div> <img style="width: 100%;" riot-src="{picshow}" class="imgsetwidth"> </div> <div class="banner" onclick="{uploadimg}" if="{!test}" style="position: relative"> <div style="position: absolute;bottom:10px;right:10px;width:24px;height:24px;z-index: 100;"> <img style="width:24px;height:24px" riot-src="/{env}/images/5.0.8.png"> </div> <img id="banner" style="width: 100%;" riot-src="{imgsrc}"> </div> <div class="activity-new-more-options-title activity-new-more-options-title-checked" onclick="{moreOptions}"> <div class="activity_title"> <span></span> 更多选项 </div> </div> <div class="options activity-new-more-options" > <div class="new_hint_div1_div2"> <p>只允许被邀请的朋友参与</p> <div class="but_wary" id="but_wary"> <p id="but_radius"></p> </div> </div> <div class="user_options"> <div class="new_hint_div1_div3"> <p>报名填写项</p> </div> <ul onclick="{userOptions}"> <li each="{name,i in appFieldNameArr}" data="{name}" class="{parent.fieldIfSel(name) ? \'checked\' : \'\'}">{__page.appFields[name].title}</li> </ul> </div> </div> <div class="clear"></div> <div class="activity-new-presentation"> <div> <p class="new_hint_p1">提示:</p> <p class="new_hint_p2">请确认活动内容后再发布!因为一旦发布并且有用户报名后,活动就不允许取消和修改了。</p> </div> </div> <div class="clear"></div> <div class="serv t-c"> <p>使用过程中如有任何疑问请咨询客服</p> <p class="m_top10_media p2"><img riot-src="/{env}/images/1_19.png"> 客服电话：400-680-9072</p> </div> <div class="footer_placeholder"></div> <div class="footer" name="btnbox"> <div onclick="{homepage}"></div> <div class="button but1" style="width:27%;" onclick="{submitdraft}">保存草稿</div> <div class="button but2" style="width:45%;" onclick="{publishpa}">立即发布</div> </div> </form> </div>',function(){var t=nest.presentable(this);t.env="production"==__app.settings.env.NODE_ENV?"public":"web",console.log("env="+t.env);var i={localIds:[],fileNames:[],serverIds:[],refresh:function(){this.localIds=[],this.serverIds=[],this.fileNames=[]}},e=domain.action("multiImgUpload"),a=new util.wedgt.WcEditor({modules:{Bold:!0,Color:!0,Img:!0,TextAlign:!0},container:"editor"}),s=[],n=[],o=[],l={localIds:[],serverIds:[],refresh:function(){this.localIds=[],this.serverIds=[]}},d=this.model=nest.modelable({},{url:__app.settings.api.url+"/pa/"}),r=this.imgmodel=nest.modelable({},{url:__app.settings.api.url+"/img/"}),c=this.startTimetxt,u=this.startTime,v=this.endTimetxt,p=this.endTime,m=this.closingTimebtn,g=this.closingTime,h=this.name,f=this.place,b=__page.user.id,y=this.initiatorName,_=this.initiatorContact,w=(this.actform,this.btnbox),x=new Date(__page.servertime);t.appFields=__page.appFields,t.appFieldNameArr=Object.keys(t.appFields);var I=__app.enums.TypeTags.values;delete I.ex,delete I.tn,t.typetags=Object.keys(I),t.actobj={txtareastr:"【活动说明】</br></br>【活动日程】</br>【费用说明】自行消费</br>【集合时间】</br>【集合地点】</br>【交通方式】</br>【报名说明】</br>1、直接系统报名，报名名单中显示用户名字即报名成功；</br>2、本活动不限名额。/本活动限x人，以报名先后确认名额。</br>【温馨提示】</br>1、</br>2、</br>",initPage:function(i){c.value=i&&i.startTime&&util.dateFormat(new Date(i.startTime),"MM/dd")||util.dateFormat(x,"MM/dd"),v.value=i&&i.endTime&&util.dateFormat(new Date(i.endTime),"MM/dd")||util.dateFormat(x,"MM/dd"),m.value=i&&i.closingTime&&util.dateFormat(new Date(i.closingTime),"MM/dd")||util.dateFormat(x,"MM/dd"),h.value=i&&i.name||"",u.value=i&&i.startTime&&util.dateFormat(new Date(i.startTime),"yyyy-MM-dd")||util.dateFormat(x,"yyyy-MM-dd"),p.value=i&&i.endTime&&util.dateFormat(new Date(i.endTime),"yyyy-MM-dd")||util.dateFormat(x,"yyyy-MM-dd"),g.value=i&&i.closingTime&&util.dateFormat(new Date(i.closingTime),"yyyy-MM-dd")||util.dateFormat(x,"yyyy-MM-dd"),f.value=i&&i.place||"",b=__page.user.id,y.value=i&&i.initiatorName||"",_.value=i&&i.initiatorContact||"",t.currtypetags=i&&i.tags.type||[],t.applicationFields=i&&i.applicationFields||[],t.acDesc=util.replaceImgTemplate(i.desc),n=i.introImgs},getJsondata:function(){var i={name:h.value.trim(),startTime:u.value||x,endTime:p.value||x,place:f.value.trim(),initiator:__page.user.id,initiatorName:y.value.trim(),initiatorContact:_.value.trim(),closingTime:g.value.trim()||x,pics:[],desc:a.getContentHtml()&&util.events.htmlToTemplate(a.getContentHtml())||t.actobj.txtareastr,applicationFields:q()};return i.tags={region:"",custom:"",type:t.currtypetags||[]},i},validatefield:function(i){var e=[];return T.empty(i.name)&&e.push("活动名称不能为空"),t.currtypetags.length<=0&&e.push("请选择类型"),T.empty(i.place)&&e.push("活动地点不能为空"),T.empty(i.initiatorName)&&e.push("请填写发起人姓名"),T.empty(i.initiatorContact)&&e.push("请填写发起人联系方式"),util.compareDate(util.dateFormat(x,"yyyy-MM-dd"),u.value)&&e.push("开始时间不能早于今天"),util.compareDate(u.value,p.value)&&e.push("结束时间不能早于开始时间"),util.compareDate(g.value,u.value)&&e.push("截止时间不能晚于开始时间"),e},submitform:function(t){var l=this;i.refresh(),s=[],o=[];var r=$(util.events._wrapdiv(a.getContentHtml()));r.find("img").each(function(t){for(var e=!1,t=0,a=n.length;a>t;t++){var s=$(this).attr("fileName");if(n[t].name===s){o.push(n[t]),e=!0;break}}e||(i.localIds.push($(this).attr("localid")),i.fileNames.push($(this).attr("fileName")))}),i.localIds.length>0?l._upload4Wx(i.localIds,i.serverIds,function(a){if(a)return util.tipssuccess(1,"上传图片失败",0);for(var n,r=0,c=i.localIds.length;c>r;r++)n={localId:i.localIds[r],name:i.fileNames[r],mediaId:i.serverIds[r]},s.push(n);var u=e.newInvocation({imgArr:s});u.onDone(function(i){for(var e,a=i,s=0,n=a.length;n>s;s++)e={id:a[s]._id,name:a[s].name,mediaId:a[s].mediaId,localId:a[s].localId},o.push(e);d.set("introImgs",o),l._uploadPaObj(t)}).onFail(function(){alert("multiImgUpload fail")}).execute()}):l._uploadPaObj(t)},_uploadPaObj:function(i){l.localIds.length>0?wx.uploadImage({localId:l.localIds[0],success:function(e){var a={name:util.getFileName(),mediaId:e.serverId};r.set("myobj",a),r.save(),r.off("save").on("save",function(a){var s=[{id:a._id,mediaId:e.serverId,name:a.name}];i.images=s,i.pics[0]="/public/images/pabanner.png",i&&i.status&&"d"==i.status?d.set("query",{action:"draft"}):(t.update(),d.set("query",{action:"publish"})),i&&i.status&&delete i.status,d.set("myobj",i),d.set("privateFlag",k),d.save()})},fail:function(t){console.error(JSON.stringify(t))}}):(i&&i.status&&"d"==i.status?d.set("query",{action:"draft"}):d.set("query",{action:"publish"}),i&&i.status&&delete i.status,i.pics=["/public/images/pabanner.png"],d.set("myobj",i),d.set("privateFlag",k),d.save())},_upload4Wx:function(t,i,e){function a(){wx.uploadImage({localId:t[n],success:function(t){return i.push(t.serverId),n++,s-1>=n?(a(),void 0):e?e():void 0},fail:function(t){e(JSON.stringify(t)),console.error(JSON.stringify(t))}})}var s=t.length,n=0;a()}};var T=util.validator();d.on("save",function(t){"publish"==d.query.action&&riot.route("activity/createsuccess/_"+t._id),"draft"==d.query.action&&(d&&d.query&&delete d.query,util.tipssuccess(0,"保存成功"),t&&t.introImgs&&(n=t.introImgs))}),d.on("save-error",function(){util.tipssuccess(1,"保存失败")}),d.on("error",function(){util.tipssuccess(1,"保存失败")}),this.selecttags=function(i){var e=i.item,a=t.currtypetags.indexOf(e.name);return a>=0?t.currtypetags.splice(a,1):t.currtypetags.push(e.name)}.bind(this),this.startchange=function(){return""==u.value&&util.getBrowser().android===!1?(u.value=x,c.value=util.dateFormat(x,"MM/dd"),!1):(c.value=util.dateFormatstr(u.value),(!p||p.value<u.value)&&(p.value=u.value,t.endchange()),(!g||g.value>u.value)&&(g.value=u.value,t.closingchange()),void 0)}.bind(this),this.endchange=function(){return""==p.value&&util.getBrowser().android===!1?(p.value=x,v.value=util.dateFormat(x,"MM/dd"),!1):(v.value=util.dateFormatstr(p.value),void 0)}.bind(this),this.closingchange=function(){return""==g.value&&util.getBrowser().android===!1?(g.value=x,m.value=util.dateFormat(x,"MM/dd"),!1):(m.value=util.dateFormatstr(g.value),void 0)}.bind(this),this.publishpa=function(){var i=t.actobj.getJsondata();console.log("initiator="+i.initiator),i.status="o";var e=t.actobj.validatefield(i);return e.length>0?(util.tipssuccess(1,e[0],1),void 0):(t.actobj.submitform(i),void 0)}.bind(this),this.submitdraft=function(){var i=t.actobj.getJsondata();i.status="d";var e=t.actobj.validatefield(i);return e.length>0?(util.tipssuccess(1,e[0],1),void 0):(t.actobj.submitform(i),void 0)}.bind(this),this.moreOptions=function(){$(".options").slideToggle(),$(".activity-new-more-options-title").toggleClass("activity-new-more-options-title-checked")}.bind(this);var F,M,k=!1,C=function(){var t=document.getElementById("but_wary");t.addEventListener("touchstart",j,!1),t.addEventListener("touchmove",N,!1),t.addEventListener("touchend",O,!1)},j=function(t){t.preventDefault();var t=t||window.event;F=t.touches[0].pageX},N=function(t){t.preventDefault();var t=t||window.event;M=t.touches[0].pageX},O=function(){M>F?($(".but_wary").addClass("but_right"),$(".but_wary").removeClass("but_left"),k=!0):F>M&&($(".but_wary").addClass("but_left"),$(".but_wary").removeClass("but_right"),k=!1),F=0,M=0};t.on("toabsolute",function(){w.style.position="absolute",w.style.bottom="0px"}),t.on("tofixed",function(){w.style.position="fixed",w.style.bottom="0px"}),this.inputonfocus=function(){t.trigger("toabsolute")}.bind(this),this.inputonblur=function(){t.trigger("tofixed")}.bind(this),this.descfocus=function(){t.trigger("toabsolute")}.bind(this),this.descblur=function(){t.trigger("tofixed")}.bind(this);var D=navigator.userAgent;D.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(this.dateclick=function(){t.trigger("toabsolute")}.bind(this),this.dateblur=function(){t.trigger("tofixed")}.bind(this)),this.showSelectType=function(){var t=$(".tag-type").attr("class");t.indexOf("animation-show")>0?$(".tag-type").removeClass("animation-show").addClass("animation-hide"):$(".tag-type").removeClass("animation-hide").addClass("animation-show")}.bind(this);var S=function(i){this.trigger("ready",!1),d.set("_id",i||t.opts._id),d.fetch({action:"open"})}.bind(t);d.on("fetch",function(i){t.fecthjson=i,t.actobj.initPage(t.fecthjson),t.picshow=util.calcImageUrl(t.fecthjson),t.trigger("ready",!0),t.trigger("view-route-to"),a.init(),a.reset(),B(t.acDesc),$("#contentdiv").on("focus",function(){t.trigger("toabsolute")}),$("#contentdiv").on("blur",function(){t.trigger("tofixed")}),a.off("chooseImgBegin").on("chooseImgBegin",function(){wx.chooseImage({success:function(t){a.trigger("chooseImgComplete",t.localIds[0])}})}),t.update(),C()}),this.on("mount",function(){console.info("tag activities is mounted")}),this.on("open",function(i){console.info("tag activities is opening"),S(i),t.test=!0,wx.ready(function(){t.uploadimg=function(){wx.chooseImage({success:function(i){l.refresh(),l.localIds[0]=i.localIds[0],t.test=!1,t.update();var e=$("#banner");e.attr("src",i.localIds[0])}})},t.update()})});var q=function(){for(var i=[],e=$(".user_options .checked"),a=0;a<e.length;a++)i.push(t.appFields[$(e[a]).attr("data")]);return i};this.userOptions=function(t){"姓名"!=t.target.outerText&&"手机"!=t.target.outerText&&$(t.target).toggleClass("checked")}.bind(this),t.fieldIfSel=function(i){for(var e=!1,a=0,s=t.applicationFields.length;s>a;a++)if(t.applicationFields[a].name==i){e=!0;break}return e},this.homepage=function(){riot.route("activity/index")}.bind(this);var B=function(t){$("#contentdiv").html(t)}});
riot.tag("activity-filter",'<div class="activity-filter_placeholder"></div> <div class="activity-filter"> <div onclick="{parent.clickIndexNav}"> <div class="{opts.curritem.activity_filter == 1 ? \'checked\': \'\'} {opts.curritem.label_screening_select_the_conditions == true ? \'select_the_conditions\':\'\'}" alt="1" id="label_screeningId">类型筛选</div> <div class="{opts.curritem.activity_filter == 2 ? \'checked\': \'\'} {opts.curritem.date_select_the_conditions == true ? \'select_the_conditions\':\'\'}" alt="2" id="sel_date">时间筛选</div> <div class="{opts.curritem.activity_filter == 3 ? \'checked\': \'\'} {opts.curritem.sort_select_the_conditions == true ? \'select_the_conditions\':\'\'}" alt="3" id="sel_sort">排序</div> <a href="#activity/search"><img riot-src="/{env}/images/search_bj.png"></a> </div> <div class="label_screening select_pub {opts.curritem.activity_filter == 1 ? \'label_screening_animation\': \'\'} {opts.curritem.activity_filter == \'reset\' ? \'animation_reset\': \'\'}"> <ul onclick="{parent.select_type}" value="label_screening_select_the_conditions"> <li value="ca" class="set-checked-ca">校园活动</li> <li value="fa" class="set-checked-fa">亲子少儿</li> <li value="ch" class="set-checked-ch">讲座</li> <li value="tr" class="set-checked-tr">出游</li> <li value="of" class="set-checked-of">体育户外</li> <li value="pt" class="set-checked-pt">聚会派对</li> <li value="tb" class="set-checked-tb">团队建设</li> <li value="oa" class="set-checked-oa">其他活动</li> </ul> <div class="clear"></div> <div class="label_button"> <div class="label_button_div"> <button class="confirm_but1 border_radius fl" onclick="{parent.setAllType}"><img riot-src="/{env}/images/but_s1.png" class="vertical"> <span class="vertical" >全部</span></button> <button class="confirm_but2 border_radius fr" onclick="{parent.typeSelectObj}"><img riot-src="/{env}/images/but_s2.png" class="vertical"> <span class="vertical" >筛选</span></button> </div> </div> </div> <div class="select_info select_pub time_screen {opts.curritem.activity_filter == 2 ? \'time_screen_animation\': \'\'} {opts.curritem.activity_filter == \'reset\' ? \'animation_reset\': \'\'}"> <ul class="ul_sel_date" alt="sel_date" onclick="{parent.select_type}"> <li class="checked initial_checked" value="0">全部</li> <li value="1">最近三天</li> <li value="2">本周</li> <li value="3">下周</li> <li value="4">本月</li> <li value="5">下月</li> </ul> </div> <div class="select_info select_pub sort {opts.curritem.activity_filter == 3 ? \'sort_animation\': \'\'} {opts.curritem.activity_filter == \'reset\' ? \'animation_reset\': \'\'}"> <ul class="ul_sel_sort" alt="sel_sort" onclick="{parent.select_type}" value="sort_select_the_conditions"> <li class="checked initial_sort" value="acquiesce">默认（开始时间）</li> <li value="newest" class="set-checked-newest">最新（创建时间）</li> <li value="popularity" class="set-checked-popularity">人气</li> </ul> </div> </div>',function(){var e=nest.presentable(this);e.env="production"==__app.settings.env.NODE_ENV?"public":"web"});
riot.tag("activity-index",'<div if="{!hidden}"> <mask-loading show="{mask}"></mask-loading> <div if="{!mask}"> <div class="activity-index-filter"> <input type="text" placeholder="搜索感兴趣的活动" readonly="readonly" onclick="{resultSearch}"> </div> <div class="activity-index-scroll"> <ul> <li><a href="#activity/_dMxAsS"><img riot-src="/{env}/images/banner.jpg"></a></li> </ul> </div> <div class="activity-index-type"> <div> <div class="fl" value="newest" onclick="{pageResult}"> <img riot-src="/{env}/images/new_act.png" value="newest"> 最新活动 </div> <div class="fr" value="popularity" onclick="{pageResult}"> <img riot-src="/{env}/images/hot_act.png" value="popularity"> 最热活动 </div> </div> <div> <ul onclick="{pageResult}"> <li value="ca"><img riot-src="/{env}/images/type_img_1.png" value="ca">校园活动</li> <li value="fa"><img riot-src="/{env}/images/type_img_2.png" value="fa">亲子少儿</li> <li value="ch"><img riot-src="/{env}/images/type_img_3.png" value="ch">讲座</li> <li value="tr"><img riot-src="/{env}/images/type_img_4.png" value="tr">出游</li> <li value="of"><img riot-src="/{env}/images/type_img_5.png" value="of">体育户外</li> <li value="pt"><img riot-src="/{env}/images/type_img_6.png" value="pt">聚会派对</li> <li value="tb"><img riot-src="/{env}/images/type_img_7.png" value="tb">团队建设</li> <li value="oa"><img riot-src="/{env}/images/type_img_8.png" value="oa">其他活动</li> </ul> </div> </div> <div class="activity-index-recommend"> <div> <p>精彩推荐</p> <p onclick="{listAll}">全部活动</p> </div> <div class="clear"></div> <div> <activity-recommend-item each="{items}" curritem="{this}"></activity-recommend-item> </div> <div onclick="{listAll}"><p>查看全部活动</p></div> </div> <div class="footer_placeholder"></div> <div class="footer-index setleft"> <div> <a href="#activity/index"><i class="current"><img riot-src="/{env}/images/footer_nav_activity2.png"><br>活动</i></a> <a href="#travel/index"><i><img riot-src="/{env}/images/footer_nav_travel1.png"><br>场所</i></a> <a href="#mine/index"><i><img riot-src="/{env}/images/footer_nav_mine1.png"><br>我的</i></a> </div> <div> <i onclick="{showattention}">发布活动</i> </div> </div> <div class="body_shadow display_none" onclick="{hideBodyShadowAllHandler}"></div> <div class="wechat-concern display_none"> <img riot-src="/{env}/images/closebtn2.png" onclick="{hidewechat_concern}"> <p>关注“快乐种子”后，可以接收活动<br>提醒和使用其他更多服务！</p> <div if="{!fromButtonClick}"> <div onclick="{openWxhref}">关注，支持一下</div> <div onclick="{hidewechat_concern}">残忍拒绝:(</div> </div> <button onclick="{openWxhref}" if="{fromButtonClick}">立即关注</button> </div> </div> </div>',function(){function i(){$(".wechat-concern").hide(),$(".body_shadow").hide()}this.app=this.opts.app;var e=nest.presentable(this);e.env="production"==__app.settings.env.NODE_ENV?"public":"web",e.wxhref=util.getWxhref(),e.subscribe=1==__page.user.wx_subscribe?!0:!1;var t={sort:{priorityRank:-1,statusrank:1,startTime:1},page:{size:4,no:1},conditions:{status:{$in:["a","re","ac","co"]},reviewStatus:{$in:["t","d"]},"tags.type":{},privateFlag:!1}};__page.tenant&&(t.conditions.tenantId=__page.tenant);var n=this.collection=nest.collectable({},{url:__app.settings.api.url+"/pa/find",filter:t});n.on("fetch",function(i){console.info("activities is fetched"),e.items=i,e.update(),e.trigger("ready",!0),e.trigger("view-route-to"),s(),$(window).scrollTop("0px"),n.trigger("fetched"),$(".activity-index-scroll").simslider()}),n.on("append",function(){console.info("activities is append"),e.trigger("ready",!0)});{var o=function(i){this.trigger("ready",!1),this.filter=i||this.filter,void 0==n.fetched()||e.items&&0==e.items.length?n.fetch({filter:this.filter}):(e.update(),e.trigger("ready",!0),e.trigger("view-route-to")),$(window).scrollTop("0px")}.bind(e),a=function(){e.item=[],e.appended_list=[],t.page.size=10,t.page.no=1,this.trigger("ready",!1),setTimeout(function(){$("#pullDown").hide(),n.fetch({filter:this.filter})},500)}.bind(e);(function(){this.trigger("ready",!1),n.append({filter:this.filter})}).bind(e)}this.on("mount",function(){console.info("tag activities is mounted")}),this.on("unmount",function(){console.info("tag activities is unmounted")}),this.on("open",function(i){console.info("tag activities is opening"),s(),o(i)}),this.on("leave",function(){e.mask=!0,e.update()}),this.on("reenter",function(){e.mask=!1,e.update()}),this.on("refresh",function(){console.info("tag activities is refreshing"),a()}),this.on("show",function(i){i&&__page.holder().setTitle("活动"),$(window).scrollTop(__page.holder().getTop())}),this.listAll=function(){riot.route("activity/list?filter=all")}.bind(this),this.pageResult=function(i){var e=$(i.target).attr("value");riot.route("activity/list?filter="+e)}.bind(this),this.showattention=function(){if(e.fromButtonClick=!0,e.subscribe)riot.route("activity/new");else{var i=$(window).scrollTop(),t=$(window).height(),n=$("body").height(),o=$(".wechat-concern").height()-100,a=t>n?t:n,s=i+t/2-o/2-100;$(".body_shadow").show().css("height",a+"px").css("z-index","699"),$(".wechat-concern").show().css("top",s+"px")}}.bind(this),this.hideBodyShadowAllHandler=function(){i()}.bind(this),this.hidewechat_concern=function(){i()}.bind(this),this.resultSearch=function(){riot.route("activity/search")}.bind(this),this.refresh=function(){a()}.bind(this),this.openWxhref=function(){util.setCookie("attentionUrl","activity/index",1),i(),window.location=e.wxhref}.bind(this);var s=function(){wx.onMenuShareAppMessage({title:"快乐种子",desc:"欢迎关注快乐种子，更多精彩活动等你参加！",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",type:"",dataUrl:"",success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")","首页","",0])},cancel:function(){}}),wx.onMenuShareTimeline({title:"快乐种子",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")","首页","",1])},cancel:function(){}})}});
riot.tag("activity-item",'<div class="screen"> <a href="#" onclick="{showPaDetail}"><img riot-src="{picshow}" class="activity-cover-img img1"></a> <div class="type-bar {status_background_color}">{statuszw}</div> <div class="top-bar"> <p><img riot-src="/{env}/images/item2.png" width="15" class="vertical"> <span class="vertical" >{this.opts.curritem.meta.apps || 0}</span></p> <p><img riot-src="{likes_imgsrc}" width="15"> <span class="vertical" >{this.opts.curritem.meta.likes || 0}</span></p> </div> <div class="bottom-bar"> <div> <p>{name.length > 15 ? name.substring(0, 15)+\'...\':name}</p> <p> <span></span>{startTimes_Week} {place.length > 12 ? place.substring(0, 12)+\'...\':place} </p> </div> </div> <div class="shadow"></div> </div>',function(){var t=this.opts.curritem;this.statuszw=__app.enums.ProductActivityStatus.values[t.status],"r"==t.reviewStatus&&(this.statuszw=__app.enums.ReviewStatus.values[t.reviewStatus]),this.num=t.meta.apps;var e=this;e.env="production"==__app.settings.env.NODE_ENV?"public":"web",e.picshow=util.calcImageUrl(t),e.likes=t.meta.likes||0,e.startTimes=util.dateFormat(new Date(t.startTime),"MM/dd"),e.Week=util.getDateWeek(new Date(t.startTime)),e.startTimes_Week=e.startTimes+" "+e.Week,e.reviewStatus=t.reviewStatus?t.reviewStatus:"",e.likes_imgsrc=__page.user.meta.pa.likes[t._id]?"/"+e.env+"/images/item1_like.png":"/"+e.env+"/images/item1.png",e.status_background_color=util.events._valueToKey(__app.enums.ProductActivityStatus.names)[t.status],this.showPaDetail=function(s){s.preventDefault(),_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.VIEW+")",e.parent.name||"",util.convertToValue(e.parent.tags.type).join(",")||""]),riot.route("activity/_"+t._id)}.bind(this),this.on("update",function(){this.likes_imgsrc=__page.user.meta.pa.likes[t._id]?"/"+e.env+"/images/item1_like.png":"/"+e.env+"/images/item1.png"})});
riot.tag("activity-list",'<div if="{!hidden}"> <mask-loading show="{mask}"></mask-loading> <div if="{!mask}"> <activity-filter curritem="{this}"></activity-filter> <div class="clear">&nbsp</div> <div id="pullDown" class="loading" style="display: none"> <span class="pullDownIcon"></span><span class="pullDownLabel">正在刷新列表...</span> </div> <div class="activity-list" id="scroll_body"> <activity-item class="activity-item" each="{items}" curritem="{this}"></activity-item> <activity-item class="activity-item" each="{appended_list}" curritem="{this}"></activity-item> </div> <div id="pullUp"> <span class="pullUpIcon"></span><span class="pullUpLabel">上拉加载更多活动...</span> </div>  <wechat-menu if="{!subscribe}"></wechat-menu> <div id="noResult" class="noResult"> <p><img riot-src="/{env}/images/c_02.png" style="width: 35%"></p> <p class="m_top10">抱歉，没有找到相关活动</p> </div>  <div class="footer_placeholder"></div> <div class="footer setleft"> <div onclick="{returnPage}"></div> <div class="button publish" onclick="{showattention}">发布活动</div> </div> <div class="body_shadow display_none" onclick="{hideBodyShadowAllHandler}"></div> <div class="wechat-concern display_none"> <img riot-src="/{env}/images/closebtn2.png" onclick="{hidewechat_concern}"> <p>关注“快乐种子”后，可以接收活动<br>提醒和使用其他更多服务！</p> <div if="{!fromButtonClick}"> <div onclick="{openWxhref}">关注，支持一下</div> <div onclick="{hidewechat_concern}">残忍拒绝:(</div> </div> <button onclick="{openWxhref}" if="{fromButtonClick}">立即关注</button> </div> </div> </div>',function(){function t(){var t=$(window).height(),e=$("body").height(),i=t>e?t:e;$(".body_shadow").show().css("height",i+"px").css("z-index","500")}function e(){$(".wechat-concern").hide(),i()}function i(){$(".body_shadow").hide(),l.activity_filter="reset",l.update()}function n(){if(!l.subscribe&&void 0==util.getCookie("showAttentionPrompt")){var t=$(window).scrollTop(),e=$(window).height(),i=$("body").height(),n=$(".wechat-concern").height()-100,s=e>i?e:i,o=t+e/2-n/2-100;$(".body_shadow").show().css("height",s+"px").css("z-index","699"),$(".wechat-concern").show().css("top",o+"px"),util.setCookie("showAttentionPrompt","true",1)}}function s(){var t=Math.round(360*$("#wary").width()/640);$(".img1").css("height",t+"px")}function o(t){void 0!=t&&(t.forEach(function(t){l.items.push(t)}),console.log("self.items "+l.items.length))}function a(t){console.log(t),0==t.length?document.getElementById("pullUp").style.display="none":(document.getElementById("pullUp").style.display="block",_.className="",_.querySelector(".pullUpLabel").innerHTML="上拉加载更多活动...")}this.app=this.opts.app;var c,l=nest.presentable(this),r=domain.action("likeActivity"),d=domain.action("applyActivity"),h=!1;l.env="production"==__app.settings.env.NODE_ENV?"public":"web",l.subscribe=1==__page.user.wx_subscribe?!0:!1,l.wxhref=util.getWxhref(),l.fromButtonClick=!1,l.activity_filter=0,l.label_screening_select_the_conditions=!1,l.date_select_the_conditions=!1,l.sort_select_the_conditions=!1;var p={sort:{priorityRank:-1,statusrank:1,startTime:1},page:{size:10,no:1},conditions:{status:{$in:["a","re","ac","co"]},reviewStatus:{$in:["t","d"]},"tags.type":{},privateFlag:!1}};__page.tenant&&(p.conditions.tenantId=__page.tenant);var u,g,_,f=this.collection=nest.collectable({},{url:__app.settings.api.url+"/pa/find",filter:p}),v=0,m=0,w=!1,y=!0;f.on("fetch",function(t){if(console.info("activities is fetched"),l.items=t,y=l.items.length%10==0?!0:!1,l.update(),l.trigger("ready",!0),l.trigger("view-route-to"),_=document.getElementById("pullUp"),g=$("#noResult"),u=document.getElementById("scroll_body"),a(t),0!=t.length?(t.length>3?$("#pullUp").show():$("#pullUp").hide(),g.hide()):($("#pullUp").hide(),g.show()),console.log("---------------------"),console.log(l.sort_select_the_conditions),U(),E(),C(),n(),$(window).scrollTop("0px"),c&&h){$(".activity-filter .checked").removeClass("checked"),$(".set-checked-"+c).addClass("checked");var e=$(".set-checked-"+c).parent().attr("value");l.label_screening_select_the_conditions=!1,l.date_select_the_conditions=!1,l.sort_select_the_conditions=!1,l[e]=!0,l.update(),"sort_select_the_conditions"!=e&&$(".initial_sort").addClass("checked"),$(".initial_checked").addClass("checked")}f.trigger("fetched")}),f.on("fetched",function(){w=!0}),f.on("append",function(t){console.info("activities is append"),o(l.appended_list),l.appended_list=t,console.log(l.appended_list),y=0==l.appended_list.length?!1:l.appended_list.length%10==0?!0:!1,l.update({appended_list:t}),a(t),l.trigger("ready",!0),E()});var b=function(t){this.trigger("ready",!1),this.filter=t||this.filter;var e=t.filter;if(e){var i=new Array;h=!0,i.push(e),$(".activity-filter .checked").removeClass("checked"),c=e,"all"===e?(p.sort={priorityRank:-1,statusrank:1,startTime:1},p.conditions={status:{$in:["a","re","ac","co"]},"tags.type":{},privateFlag:!1}):"newest"===e||"popularity"===e?(p.conditions={status:{$in:["a","re","ac","co"]},"tags.type":{},privateFlag:!1},p.sort="newest"==e?{crtOn:-1}:{"meta.likes":-1}):p.conditions={status:{$in:["a","re","ac","co"]},"tags.type":{$in:i},privateFlag:!1}}void 0==f.fetched()||l.items&&0==l.items.length||e?f.fetch({filter:this.filter}):(l.update(),l.trigger("ready",!0),l.trigger("view-route-to"))}.bind(l),k=function(){l.item=[],l.appended_list=[],p.page.size=10,p.page.no=1,this.trigger("ready",!1),setTimeout(function(){$("#pullDown").hide(),f.fetch({filter:this.filter})},500)}.bind(l),x=function(){this.trigger("ready",!1),f.append({filter:this.filter})}.bind(l),D=function(t){l.items=l.items.concat(l.appended_list);for(var e=0;e<l.items.length;e++)if(l.items[e]._id==this.inputs[0]){l.appended_list=[],l.items[e].meta.likes=t,l.update();break}},T=function(t){l.items=l.items.concat(l.appended_list);for(var e=0;e<l.items.length;e++)if(l.items[e]._id==this.inputs[0].id){l.appended_list=[];for(var i=0,n=0;n<t.length;n++)i+=t[n].num;l.items[e].meta.apps=i,l.update();break}};this.on("mount",function(){console.info("tag activities is mounted"),r.onDone(D),d.onDone(T)}),this.on("unmount",function(){console.info("tag activities is unmounted"),r.offDone(D),d.offDone(T)}),this.on("open",function(t){console.info("tag activities is opening"),C(),b(t),E()}),this.on("leave",function(){l.mask=!0,l.update()}),this.on("reenter",function(){l.mask=!1,l.update()}),this.on("refresh",function(){console.info("tag activities is refreshing"),k()}),this.on("show",function(t){t&&__page.holder().setTitle("活动"),$(window).scrollTop(__page.holder().getTop())}),this.refresh=function(){k()}.bind(this);this.returnPage=function(){riot.route("activity/index")}.bind(this),this.showFootterNav=function(t){$(t.target).toggleClass("footer_navs_but_hover");var e=$(t.target).attr("class");e.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(200):$(".footer_navs_wary").slideDown(200),t.stopPropagation()}.bind(this),this.clickIndexNav=function(e){{var n=$(e.target).attr("alt")||"",s=$(e.target).attr("class");$(".select_the_conditions")}s.indexOf("checked")<0?(l.activity_filter=n,l.update(),t()):(l.activity_filter="reset",l.update(),i())}.bind(this),this.select_type=function(t){var i=$(t.target).attr("value"),n=$(t.target).text(),s=$(t.target).parent().attr("alt");if($("#"+s).text(n),$("#"+s).addClass("select_the_conditions"),h=!1,"sel_date"==s){$(".ul_sel_date li").removeClass("checked");var o;switch(i){case"0":o={},$("#"+s).text("时间筛选"),$("#"+s).removeClass("select_the_conditions");break;case"1":o={$gte:util.getLastDayStartDate(),$lte:util.getLastDayEndDate()};break;case"2":o={$gte:util.getWeekStartDate(),$lte:util.getWeekEndDate()};break;case"3":o={$gte:util.getNextWeekStartDate(),$lte:util.getNextWeekEndDate()};break;case"4":o={$gte:util.getMonthStartDate(),$lte:util.getMonthEndDate()};break;case"5":o={$gte:util.getNextMonthStartDate(),$lte:util.getNextMonthEndDate()};break;default:console.log("no match!!!")}p.conditions.startTime=o,k(),l.date_select_the_conditions=0!=i?!0:!1,e()}else"sel_sort"==s&&($(".ul_sel_sort li").removeClass("checked"),"acquiesce"==i?($("#"+s).text("排序"),$("#"+s).removeClass("select_the_conditions"),p.sort={priorityRank:-1,statusrank:1,startTime:1},l.sort_select_the_conditions=!1):"newest"==i?($("#"+s).text("最新"),p.sort="newest"==i?{crtOn:-1}:{"meta.apps":-1},l.sort_select_the_conditions=!0):(p.sort="newest"==i?{crtOn:-1}:{"meta.likes":-1},l.sort_select_the_conditions=!0),e(),k());$(t.target).toggleClass("checked")}.bind(this),this.typeSelectObj=function(){var t=$(".label_screening .checked");if(h=!1,t.length>0){for(var i=[],n=0;n<t.length;n++)i.push($(t[n]).attr("value"));p.conditions={status:{$in:["a","re","ac","co"]},"tags.type":{$in:i},privateFlag:!1},__page.tenant&&(p.conditions.tenantId=__page.tenant),k();var s=function(){l.label_screening_select_the_conditions=!0,e(),f.off("fetch",s)};f.off("fetch",s).on("fetch",s)}}.bind(this),this.setAllType=function(){h=!1,$(".label_screening li").removeClass("checked"),p.conditions={status:{$in:["a","re","ac","co"]},"tags.type":{},privateFlag:!1},__page.tenant&&(p.conditions.tenantId=__page.tenant),l.label_screening_select_the_conditions=!1,k(),e()}.bind(this),this.hidewechat_concern=function(){e()}.bind(this),this.hideBodyShadowAllHandler=function(){e()}.bind(this),this.openWxhref=function(){util.setCookie("attentionUrl","activity/index",1),e(),window.location=l.wxhref}.bind(this),this.showattention=function(){if(l.fromButtonClick=!0,l.subscribe)riot.route("activity/new");else{var t=$(window).scrollTop(),e=$(window).height(),i=$("body").height(),n=$(".wechat-concern").height()-100,s=e>i?e:i,o=t+e/2-n/2-100;$(".body_shadow").show().css("height",s+"px").css("z-index","699"),$(".wechat-concern").show().css("top",o+"px")}}.bind(this);var E=function(){s()},U=function(){function t(t){var t=t||window.event;switch(t.type){case"touchstart":console.log("touchstart"),v=t.targetTouches[0].screenY;break;case"touchcancel":case"touchend":console.log("touchend"),_.className.match("flip")&&(_.className="loading",_.querySelector(".pullUpLabel").innerHTML="加载中...",1==y?(y=!1,p.page.no++,x()):document.getElementById("pullUp").style.display="none");break;case"touchmove":console.log("touchmove");var e=t.targetTouches[0],i=!1;"IMG"==$(e.target)[0].tagName&&$(e.target).attr("class").indexOf("activity-cover-img")>-1&&e.pageY>45&&(i=!0),m=e.screenY,m-v>0&&i&&0===$(window).scrollTop()&&w&&(w=!1,$("#pullDown").show(),k());var n=parseFloat($(window).height())+parseFloat($(window).scrollTop());__page.holder().saveTop($(window).scrollTop()),$(document).height()-25<=n&&$(document).height()<=n?_.className.match("flip")||(_.className="flip",_.querySelector(".pullUpLabel").innerHTML="松开加载更多活动..."):$(document).height()-50<=n&&$(document).height()-25>=n&&_.className.match("flip")&&(_.className="",_.querySelector(".pullUpLabel").innerHTML="上拉加载更多活动...")}}u.addEventListener("touchstart",t,!1),u.addEventListener("touchmove",t,!1),u.addEventListener("touchend",t,!1),u.addEventListener("touchcancel",t,!1),$(window).resize(function(){s()})},C=function(){wx.onMenuShareAppMessage({title:"快乐种子",desc:"欢迎关注快乐种子，更多精彩活动等你参加！",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",type:"",dataUrl:"",success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")","首页","",0])},cancel:function(){}}),wx.onMenuShareTimeline({title:"快乐种子",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",success:function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")","首页","",1])},cancel:function(){}})}});
riot.tag("activity-menu",' <div class="footer_navs_wary display_none"> <a href="#activity/index" class="nav1">活动</a> <a href="#travel/index" class="nav2">场所</a> <a href="#mine/index" class="nav3">我的</a> <a href="{wxhref}" class="nav4" if="{!subscribe}">关注快乐种子</a> </div>',function(){self=this,self.subscribe=1==__page.user.wx_subscribe?!0:!1;var e=function(){return"production"==__app.settings.env.NODE_ENV?"public":"web"};self.wxhref=util.getWxhref(),self.env=e(),console.log("env="+self.env)});
riot.tag("activity-new",' <div id="addactbody" if="{!hidden}"> <div class="activity-new-statement"> <p>提醒：活动内容包含违法、反动信息或者冒用他人/组织的名义发布活动，平台有权删除其活动并提交公安机关处理</p> <img riot-src="/{env}/images/closebtn3.png" class="closebtn3" onclick="{closeStatement}"> </div> <form id="actform"> <div class="activity-new-basic-info"> <section> <div class="secleft"><img riot-src="/{env}/images/new1.png"></div> <div class="secright"> <input type="text" onfocus="{inputonfocus}" onblur="{inputonblur}" name="name" value="" placeholder="活动名称"> </div> </section> <section class="tag-type"> <div class="secleft"><p class="p1"><img riot-src="/{env}/images/new2.png"></p> <p class="p2" onclick="{showSelectType}">类型标签</p></div> <div class="secright"> <ul> <li each="{name,i in typetags}" data="{name}" class="{tagdefault:true,checked:parent.currtypetags.indexOf(name)>=0} {(i==3||i==7)?\'no_m_left\':\'\'}" onclick="{parent.selecttags}"> <i>{__app.enums.TypeTags.values[name]}</i> </li> </ul> </div> </section> <section class="activity-time"> <div class="secleft"><img riot-src="/{env}/images/new3.png"></div> <div class="secright"> <div class="fl div_left">活动时间</div> <div class="fl div_right"> <div id="startTimebtn" class="datediv"> <input type="text" id="startTimetxt" value="00/00" readonly="readonly"> <input id="startTime" onchange="{startchange}" onclick="{dateclick}" onblur="{dateblur}" name="startTime" style="display: inline-block;margin-top:0px;" type="date"> </div> <i></i> <div id="endTimebtn" class="datedivright"> <input type="text" id="endTimetxt" value="00/00" readonly="readonly"> <input id="endTime" onchange="{endchange}" onclick="{dateclick}" onblur="{dateblur}" name="endTime" style="display: inline-block;margin-top:0px" type="date"> </div> </div> </div> </section> <section> <div class="secleft"><img riot-src="/{env}/images/new4.png"></div> <div class="secright"> <div></div> <input type="text" onfocus="{inputonfocus}" onblur="{inputonblur}" name="place" value="" placeholder="活动地点"> </div> </section> <section class="initiator"> <div class="secleft"><img riot-src="/{env}/images/new5.png"></div> <div class="secright"> <div class="fl div_left">发起人</div> <div class="fl div_right"> <div><input type="text" id="displayName" onfocus="{inputonfocus}" onblur="{inputonblur}" name="initiatorName" placeholder="姓名" value="{__page.user.displayName}"></div> <div><span class="borderleft"></span><input type="text" onfocus="{inputonfocus}" id="phone" onblur="{inputonblur}" name="initiatorContact" placeholder="联系方式"></div> </div> </div> </section> <section class="deadline"> <div class="secleft"><img riot-src="/{env}/images/new6.png"></div> <div class="secright"> <div class="fl div_left">报名截止</div> <div class="fl div_right"> <div class="datediv datediv360"> <input id="closingTimebtn" type="text" attr="closingTime" value="00/00" readonly="readonly"> <input id="closingTime" onchange="{closingchange}" onclick="{dateclick}" onblur="{dateblur}" name="closingTime" style="display: inline-block;margin-left:0;" type="date"> </div> </div> </div> </section> </div> <div class="activity-new-activity-introduction-title"> <div class="activity_title"> <span></span> 活动介绍 </div> </div> <div id="editor"></div>        <div class="banner" onclick="{uploadimg}" if="{test}" style="position: relative"> <img style="width: 100%" riot-src="/{env}/images/pabannershow.png"> </div> <div class="banner" onclick="{uploadimg}" if="{!test}" style="position: relative"> <div style="position: absolute;bottom:10px;right:10px;width:24px;height:24px;z-index: 100;"> <img style="width:24px;height:24px" riot-src="/{env}/images/5.0.8.png"> </div> <img id="banner" style="width: 100%;" riot-src="{imgsrc}"> </div> <div class="activity-new-more-options-title activity-new-more-options-title-checked" onclick="{moreOptions}"> <div class="activity_title"> <span></span> 更多选项 </div> </div> <div class="options activity-new-more-options"> <div class="new_hint_div1_div2"> <p>只允许被邀请的朋友参与</p> <div class="but_wary" id="but_wary"> <p id="but_radius"></p> </div> </div> <div class="user_options"> <div class="new_hint_div1_div3"> <p>报名填写项</p> </div> <ul onclick="{userOptions}"> <li each="{name,i in appFieldNameArr}" data="{name}" class="{i < 2 || name == \'desc\' ? \'checked\':\'\'}">{__page.appFields[name].title}</li> </ul> </div> </div> <div class="clear"></div> <div class="activity-new-presentation"> <div> <p class="new_hint_p1">提示:</p> <p class="new_hint_p2">请确认活动内容后再发布!因为一旦发布并且有用户报名后,活动就不允许取消和修改了。</p> </div> </div> <div class="clear"></div> <div class="serv t-c"> <p>使用过程中如有任何疑问请咨询客服</p> <p class="m_top10_media p2"><img riot-src="/{env}/images/1_19.png"> 客服电话：400-680-9072</p> </div> <div class="footer_placeholder"></div> <div class="footer" name="btnbox"> <div onclick="{homepage}"></div> <div class="button but1" style="width:27%;" onclick="{submitdraft}">保存草稿</div> <div class="button but2" style="width:45%;" onclick="{publishpa}">立即发布</div> </div> </form> </div>',function(){var t=nest.presentable(this);t.env="production"==__app.settings.env.NODE_ENV?"public":"web";var e={localIds:[],fileNames:[],serverIds:[],refresh:function(){this.localIds=[],this.serverIds=[],this.fileNames=[]}},i=domain.action("loadContact"),a=domain.action("multiImgUpload"),s=domain.action("judgeIfTenantMember"),n=new util.wedgt.WcEditor({modules:{Bold:!0,Color:!0,Img:!0,TextAlign:!0},container:"editor"}),o=[],l=null,d=[],r={localIds:[],serverIds:[],refresh:function(){this.localIds=[],this.serverIds=[]}},c=this.imgmodel=nest.modelable({},{url:__app.settings.api.url+"/img/"}),u=this.model=nest.modelable({},{url:__app.settings.api.url+"/pa/"}),v=this.startTimetxt,p=this.startTime,m=this.endTimetxt,g=this.endTime,h=this.closingTimebtn,f=this.closingTime,b=this.name,y=this.place,_=__page.user.id,w=this.initiatorName,x=this.initiatorContact,I=(this.desc,this.actform,this.btnbox),T=new Date(__page.servertime);t.appFields=__page.appFields,t.appFieldNameArr=Object.keys(t.appFields);var k=__app.enums.TypeTags.values;delete k.ex,delete k.tn,t.typetags=Object.keys(k),t.test=!0,t.actobj={txtareastr:"【活动主题】</br></br> 【活动日程】</br>   8：00 在xx集合；</br>【费用说明】</br>【报名说明】</br>    1、直接系统报名，队友名单中显示用户名字即报名成功；</br>    2、本活动不限名额。</br>【温馨提示】",initPage:function(){v.value=util.dateFormat(T,"MM/dd"),m.value=util.dateFormat(T,"MM/dd"),h.value=util.dateFormat(T,"MM/dd"),b.value="",p.value=util.dateFormat(T,"yyyy-MM-dd"),g.value=util.dateFormat(T,"yyyy-MM-dd"),f.value=util.dateFormat(T,"yyyy-MM-dd"),y.value="",_=__page.user.id,w.value=__page.user.displayName,x.value="",n.setContentHtml(this.txtareastr);var t=i.newInvocation(__page.user.id);t.onDone(function(t){t.contact&&($("#displayName").val(t.contact.displayName),$("#phone").val(t.contact.phone))}).execute(),o=[],r.refresh(),e.refresh(),j(),P(),M=!1,$(".but_wary").addClass("but_left"),$(".but_wary").removeClass("but_right")},getJsondata:function(){var e={name:b.value.trim(),startTime:p.value||T,endTime:g.value||T,place:y.value.trim(),initiator:__page.user.id,initiatorName:w.value.trim(),initiatorContact:x.value.trim(),closingTime:f.value.trim()||T,pics:[],desc:n.getContentHtml()&&util.events.htmlToTemplate(n.getContentHtml())||t.actobj.txtareastr,applicationFields:E()};return e.tags={region:"",custom:"",type:t.currtypetags||[]},e},validatefield:function(e){console.log(C);var i=[];return C.empty(e.name)&&i.push("活动名称不能为空"),t.currtypetags.length<=0&&i.push("请选择类型"),C.empty(e.place)&&i.push("活动地点不能为空"),C.empty(e.initiatorName)&&i.push("请填写发起人姓名"),C.empty(e.initiatorContact)&&i.push("请填写发起人联系方式"),util.compareDate(util.dateFormat(T,"yyyy-MM-dd"),p.value)&&i.push("开始时间不能早于今天"),util.compareDate(p.value,g.value)&&i.push("结束时间不能早于开始时间"),util.compareDate(f.value,p.value)&&i.push("截止时间不能晚于开始时间"),i},submitform:function(t){var i=this;e.refresh(),o=[],d=[];var s=$(util.events._wrapdiv(n.getContentHtml()));null!=l?s.find("img").each(function(t){for(var i=!1,t=0,a=l.length;a>t;t++){var s=$(this).attr("fileName");if(l[t].name===s){d.push(l[t]),i=!0;break}}i||(e.localIds.push($(this).attr("localid")),e.fileNames.push($(this).attr("fileName")))}):s.find("img").each(function(){e.localIds.push($(this).attr("localid")),e.fileNames.push($(this).attr("fileName"))}),e.localIds.length>0?i._upload4Wx(e.localIds,e.serverIds,function(s){if(s)return util.tipssuccess(1,"上传图片失败",0);for(var n,l=0,r=e.localIds.length;r>l;l++)n={localId:e.localIds[l],name:e.fileNames[l],mediaId:e.serverIds[l]},o.push(n);var c=a.newInvocation({imgArr:o});c.onDone(function(e){for(var a,s=e,n=0,o=s.length;o>n;n++)a={id:s[n]._id,name:s[n].name,mediaId:s[n].mediaId,localId:s[n].localId},d.push(a);u.set("introImgs",d),i._uploadPaObj(t)}).onFail(function(){alert("multiImgUpload fail")}).execute()}):i._uploadPaObj(t)},_uploadPaObj:function(e){r.localIds.length>0?wx.uploadImage({localId:r.localIds[0],success:function(i){var a={name:util.getFileName(),mediaId:i.serverId};c.set("myobj",a),c.save(),c.off("save").on("save",function(a){var s=[{id:a._id,mediaId:i.serverId,name:a.name}];e.images=s,e.pics[0]="/public/images/pabanner.png",e&&e.status&&"d"==e.status?u.set("query",{action:"draft"}):(t.update(),u.set("query",{action:"publish"})),e&&e.status&&delete e.status,u.set("myobj",e),u.set("privateFlag",M),u.save()})},fail:function(t){console.error(JSON.stringify(t))}}):(e&&e.status&&"d"==e.status?u.set("query",{action:"draft"}):u.set("query",{action:"publish"}),e&&e.status&&delete e.status,e.pics=["/public/images/pabanner.png"],u.set("myobj",e),u.set("privateFlag",M),u.save())},_upload4Wx:function(t,e,i){function a(){wx.uploadImage({localId:t[n],success:function(t){return e.push(t.serverId),n++,s-1>=n?(setTimeout(a,500),void 0):i?i():void 0},fail:function(t){i(JSON.stringify(t)),console.error(JSON.stringify(t))}})}var s=t.length,n=0;a()}},this.homepage=function(){riot.route("activity/index")}.bind(this);var C=util.validator();u.on("save",function(e){u.set("_id",e._id),"publish"==u.query.action&&(_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.PUBLISH+")",e.name||"",util.convertToValue(t.currtypetags).join(",")||""]),riot.route("#activity/createsuccess/_"+e._id)),"draft"==u.query.action&&(u&&u.query&&delete u.query,util.tipssuccess(0,"保存成功"),e&&e.introImgs&&(l=e.introImgs))}),u.on("save-error",function(){util.tipssuccess(1,"保存失败")}),u.on("error",function(){util.tipssuccess(1,"保存失败")}),this.selecttags=function(e){var i=e.item,a=t.currtypetags.indexOf(i.name);return a>=0?t.currtypetags.splice(a,1):t.currtypetags.push(i.name)}.bind(this),this.startchange=function(){return""==p.value&&util.getBrowser().android===!1?(p.value=T,v.value=util.dateFormat(T,"MM/dd"),!1):(v.value=util.dateFormatstr(p.value),(!g||g.value<p.value)&&(g.value=p.value,t.endchange()),(!f||f.value>p.value)&&(f.value=p.value,t.closingchange()),void 0)}.bind(this),this.endchange=function(){return""==g.value&&util.getBrowser().android===!1?(g.value=T,m.value=util.dateFormat(T,"MM/dd"),!1):(m.value=util.dateFormatstr(g.value),void 0)}.bind(this),this.closingchange=function(){return""==f.value&&util.getBrowser().android===!1?(f.value=T,h.value=util.dateFormat(T,"MM/dd"),!1):(h.value=util.dateFormatstr(f.value),void 0)}.bind(this),this.publishpa=function(){var e=t.actobj.getJsondata();console.log("initiator="+e.initiator),e.status="o";var i=t.actobj.validatefield(e);if(i.length>0)return util.tipssuccess(1,i[0],1),void 0;if(__page.tenant&&__page.user.wx_openid){var a={};a.tenantId=__page.tenant,a.wx_openid=__page.user.wx_openid;var n=s.newInvocation(a);n.onDone(function(i){i&&(e.tenantId=__page.tenant),t.actobj.submitform(e)}).onFail(function(){util.tipssuccess(1,"用户授权失败",1)}).execute()}else t.actobj.submitform(e)}.bind(this),this.submitdraft=function(){var e=t.actobj.getJsondata();e.status="d";var i=t.actobj.validatefield(e);if(i.length>0)return util.tipssuccess(1,i[0],1),void 0;if(__page.tenant&&__page.user.wx_openid){var a={};a.tenantId=__page.tenant,a.wx_openid=__page.user.wx_openid;var n=s.newInvocation(a);n.onDone(function(i){i&&(e.tenantId=__page.tenant),t.actobj.submitform(e)}).onFail(function(){util.tipssuccess(1,"用户授权失败",1)}).execute()}else t.actobj.submitform(e)}.bind(this),this.moreOptions=function(){$(".options").slideToggle(),$(".activity-new-more-options-title").toggleClass("activity-new-more-options-title-checked")}.bind(this),this.userOptions=function(t){"姓名"!=t.target.outerText&&"手机"!=t.target.outerText&&$(t.target).toggleClass("checked")}.bind(this);var F,N,M=!1,j=function(){var t=document.getElementById("but_wary");t.addEventListener("touchstart",O,!1),t.addEventListener("touchmove",D,!1),t.addEventListener("touchend",S,!1)},O=function(t){t.preventDefault();var t=t||window.event;F=t.touches[0].pageX},D=function(t){t.preventDefault();var t=t||window.event;N=t.touches[0].pageX},S=function(){N>F?($(".but_wary").addClass("but_right"),$(".but_wary").removeClass("but_left"),M=!0):F>N&&($(".but_wary").addClass("but_left"),$(".but_wary").removeClass("but_right"),M=!1),F=0,N=0},P=function(){var t=util.getCookie("noSetatementShow");t&&$(".activity-new-statement").hide()};t.on("toabsolute",function(){I.style.position="absolute",I.style.bottom="0px"}),t.on("tofixed",function(){I.style.position="fixed",I.style.bottom="0px"}),this.inputonfocus=function(){t.trigger("toabsolute")}.bind(this),this.inputonblur=function(){t.trigger("tofixed")}.bind(this),this.descfocus=function(){t.trigger("toabsolute")}.bind(this),this.descblur=function(){t.trigger("tofixed")}.bind(this);var q=navigator.userAgent;q.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(this.dateclick=function(){t.trigger("toabsolute")}.bind(this),this.dateblur=function(){t.trigger("tofixed")}.bind(this)),this.showFootterNav=function(t){$(t.target).toggleClass("footer_navs_but_hover");var e=$(t.target).attr("class");e.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(200):$(".footer_navs_wary").slideDown(200),t.stopPropagation()}.bind(this),this.showSelectType=function(){var t=$(".tag-type").attr("class");t.indexOf("animation-show")>0?$(".tag-type").removeClass("animation-show").addClass("animation-hide"):$(".tag-type").removeClass("animation-hide").addClass("animation-show")}.bind(this),this.closeStatement=function(){$(".activity-new-statement").addClass("close_transition"),util.setCookie("noSetatementShow","true","7")}.bind(this);var A=function(){this.trigger("ready",!1),this.update(),this.trigger("ready",!0),this.trigger("view-route-to"),$("#textareadiv").one("click",function(){util.setCookie("ReadedPushlishTips","true",30),$("#textareatips").remove()}),n.init(),n.reset(),$("#contentdiv").on("focus",function(){t.trigger("toabsolute")}),$("#contentdiv").on("blur",function(){t.trigger("tofixed")}),n.off("chooseImgBegin").on("chooseImgBegin",function(){wx.chooseImage({success:function(t){n.trigger("chooseImgComplete",t.localIds[0])}})})}.bind(t);this.on("mount",function(){console.info("tag activities is mounted")}),this.on("show",function(t){t&&__page.holder().setTitle("发布活动"),$(window).scrollTop(__page.holder().getTop())}),this.on("open",function(e){A(e),t.test=!0,t.actobj.initPage(),u&&u._id&&delete u._id,u&&u.query&&delete u.query,t.currtypetags=[],wx.ready(function(){t.uploadimg=function(){wx.chooseImage({success:function(e){r.refresh(),r.localIds[0]=e.localIds[0],t.test=!1,t.update();var i=$("#banner");i.attr("src",e.localIds[0])}})},t.update()}),$(window).scrollTop("0px")});var E=function(){for(var e=[],i=$(".user_options .checked"),a=0;a<i.length;a++)e.push(t.appFields[$(i[a]).attr("data")]);return e}});
riot.tag("activity-recommend-item",'<div class="activity-recommend-item" onclick="{showPaDetail}"> <div> <img riot-src="{picshow}"> </div> <div> <p>{name.length > 24 ? name.substring(0, 24)+\'...\':name}</p> <p>{startTimes} {place.length > 8 ? place.substring(0, 8)+\'...\':place}</p> <p>{num}人报名 {likes}人点赞</p> </div> </div>',function(){var t=this.opts.curritem,e=this;e.num=t.meta.apps,e.picshow=util.calcImageUrl(t),e.likes=t.meta.likes||0,e.startTimes=util.dateFormat(new Date(t.startTime),"MM/dd"),e.Week=util.getDateWeek(new Date(t.startTime)),e.startTimes_Week=e.startTimes+" "+e.Week,e.name=t.name,this.showPaDetail=function(i){i.preventDefault(),_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.VIEW+")",e.parent.name||"",util.convertToValue(e.parent.tags.type).join(",")||""]),riot.route("activity/_"+t._id)}.bind(this)});
riot.tag("activity-search",'<div if="{!hidden}"> <mask-loading show="{mask}"></mask-loading> <div id="scroll_body" if="{!mask}"> <mask-loading show = "{!ready}"></mask-loading> <div class="search"> <input type="text" name="name" id="search_info" placeholder="输入活动名搜索"><input type="button" onclick="{search}" value="搜索"> </div> <div class="search_placeholder"></div> <div id="pullDown" class="loading" style="display: none"> <span class="pullDownIcon"></span><span class="pullDownLabel">正在刷新列表...</span> </div> <div class="activity-list"> <activity-item class="activity-item" each="{items}" curritem="{this}"></activity-item> <activity-item class="activity-item" each="{appended_list}" curritem="{this}"></activity-item> </div> <div id="pullUp" style="display: none"> <span class="pullUpIcon"></span><span class="pullUpLabel">上拉加载更多活动...</span> </div> <div id="noResult" style="display: none;text-align:center;padding-top:80px;font-size:14px;color:#666;"> <p><img riot-src="/{env}/images/c_02.png" style="width: 35%"></p> <p class="m_top10">抱歉，没有找到相关活动</p> </div>  <div class="footer_placeholder"></div> <div class="footer" name="btnbox"> <div onclick="{homepage}"></div> <div class="button publish" onclick="{showattention_by_publish}">发布活动</div> </div> </div> </div>',function(){function e(){var e=Math.round(360*$("#wary").width()/640);$(".img1").css("height",e+"px")}function t(e){void 0!=e&&(e.forEach(function(e){n.items.push(e)}),console.log("self.items "+n.items.length))}function i(e){console.log(e),0==e.length?document.getElementById("pullUp").style.display="none":(document.getElementById("pullUp").style.display="block",c.className="",c.querySelector(".pullUpLabel").innerHTML="上拉加载更多活动...")}this.app=this.opts.app;var n=nest.presentable(this);n.env="production"==__app.settings.env.NODE_ENV?"public":"web",console.log("env="+n.env);var o=this.name,s={sort:{priorityRank:-1,rank:-1},page:{size:10,no:1},conditions:{status:{$in:["a","re","ac","co"]},reviewStatus:{$in:["t","d"]},privateFlag:!1}};__page.tenant&&(s.conditions.tenantId=__page.tenant);var a,l,c,d=this.collection=nest.collectable({},{url:__app.settings.api.url+"/pa/find",filter:s}),r=domain.action("likeActivity"),p=domain.action("applyActivity"),u=0,h=0,g=!1,m=!0;d.on("fetch",function(e){console.info("activities is fetched"),n.items=e,n.appended_list=[],m=n.items.length%10==0?!0:!1,n.update(),n.trigger("ready",!0),n.trigger("view-route-to"),c=document.getElementById("pullUp"),l=$("#noResult"),a=document.getElementById("scroll_body"),i(e),0!=e.length?(e.length>3?$("#pullUp").show():$("#pullUp").hide(),l.hide()):($("#pullUp").hide(),l.show()),U(),k(),b(),$(window).scrollTop("0px"),c.className="",d.trigger("fetched")}),d.on("fetched",function(){g=!0}),d.on("append",function(e){console.info("activities is append"),t(n.appended_list),n.appended_list=e,m=0==n.appended_list.length?!1:n.appended_list.length%10==0?!0:!1,n.update({appended_list:e}),n.trigger("ready",!0),i(e)});var v=function(e){this.trigger("ready",!1),this.filter=e||this.filter,d.fetch({filter:this.filter})}.bind(n),f=function(){this.trigger("ready",!1),d.append({filter:this.filter})}.bind(n),y=function(){return s.keyword=o.value.trim(),s.page.no=1,0==s.keyword.length?(util.tipssuccess(1,"搜索内容不能为空",1),setTimeout(function(){$("#pullDown").hide()},300),void 0):(setTimeout(function(){$("#pullDown").hide(),n.trigger("ready",!1),v()},500),void 0)};this.search=function(){return s.keyword=o.value.trim(),s.page.no=1,0==s.keyword.length?(util.tipssuccess(1,"搜索内容不能为空",1),void 0):($("#pullDown").hide(),n.trigger("ready",!1),v(),void 0)}.bind(this);var _=function(e){n.items=n.items.concat(n.appended_list);for(var t=0;t<n.items.length;t++)if(n.items[t]._id==this.inputs[0]){n.appended_list=[],n.items[t].meta.likes=e,n.update();break}},w=function(e){n.items=n.items.concat(n.appended_list);for(var t=0;t<n.items.length;t++)if(n.items[t]._id==this.inputs[0].id){n.appended_list=[];for(var i=0,o=0;o<e.length;o++)i+=e[o].num;n.items[t].meta.apps=i,n.update();break}};this.on("mount",function(){console.info("tag activities is mounted"),r.onDone(_),p.onDone(w)}),this.on("unmount",function(){console.info("tag activities is unmounted"),r.offDone(_),p.offDone(w)}),this.on("open",function(){console.info("tag activities is opening"),this.trigger("ready",!1),this.update(),this.trigger("ready",!0),n.trigger("view-route-to"),document.getElementById("search_info").focus()}),this.on("leave",function(){n.mask=!0,n.update()}),this.on("reenter",function(){n.mask=!1,n.update()}),this.on("show",function(e){n.trigger("ready",!0),e&&__page.holder().setTitle("搜索"),$(window).scrollTop(__page.holder().getTop())});var b=function(){$(document).on("click",function(){$(".footer_navs_wary").slideUp(),$(".footer_navs_but").removeClass("footer_navs_but_hover")})},k=function(){e()};this.homepage=function(){riot.route("activity/index")}.bind(this),this.showattention_by_publish=function(){riot.route("activity/new")}.bind(this);var U=function(){function t(e){var e=e||window.event;switch(e.type){case"touchstart":console.log("touchstart"),u=e.targetTouches[0].screenY;break;case"touchcancel":case"touchend":console.log("touchend"),c.className.match("flip")&&(c.className="loading",c.querySelector(".pullUpLabel").innerHTML="加载中...",1==m?(m=!1,s.page.no++,f()):document.getElementById("pullUp").style.display="none");break;case"touchmove":console.log("touchmove");var t=e.targetTouches[0],i=!1;"IMG"==$(t.target)[0].tagName&&$(t.target).attr("class").indexOf("activity-cover-img")>-1&&t.pageY>45&&(i=!0),h=t.screenY,h-u>0&&i&&0===$(window).scrollTop()&&g&&(g=!1,$("#pullDown").show(),y());var n=parseFloat($(window).height())+parseFloat($(window).scrollTop());__page.holder().saveTop($(window).scrollTop()),$(document).height()-25<=n&&$(document).height()<=n?c.className.match("flip")||(c.className="flip",c.querySelector(".pullUpLabel").innerHTML="松开加载更多活动..."):$(document).height()-50<=n&&$(document).height()-25>=n&&c.className.match("flip")&&(c.className="",c.querySelector(".pullUpLabel").innerHTML="上拉加载更多活动...")}}a.addEventListener("touchstart",t,!1),a.addEventListener("touchmove",t,!1),a.addEventListener("touchend",t,!1),a.addEventListener("touchcancel",t,!1),$(window).resize(function(){e()}),wx.ready(function(){wx.onMenuShareAppMessage({title:"快乐种子",desc:"欢迎关注快乐种子，更多精彩活动等你参加！",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"快乐种子",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",success:function(){},cancel:function(){}})})}});
riot.tag("add-randomnotes",'<div if="{!hidden}" class="add-randomnotes"> <textarea name="desc" onfocus="{inputonfocus}" onblur="{inputonblur}" placeholder="写点想说的话吧..."></textarea> <div class="random_img_wary"> <ul> <li each="{name, i in localIds}"> <img id="thumbnail" riot-src="{name}"> <div class="delete_img_button" ><span></span></div> <span onclick="{ parent.removeImg }" class="delete_img_click_area" ></span> </li> </ul> <div id="filePicker" class="random_img_but">+</div> </div> <div class="clear"></div> <div onclick="{shareOrNotToggle}"> <div class="{checked:!shareOrNot}" onclick="{ return; }"></div> <span class="vertical"> 分享到朋友圈或者朋友</span> </div> <div class="footer" name="btnbox"> <div onclick="{submitdraft}"></div> <div class="button randomnote" onclick="{sendNote}">发送</div> </div> </div>',"add-randomnotes ul li{ position:relative;overflow: hidden;float: left; }",function(){function i(i){var t={desc:"",pics:[],initiator:"",initiatorName:""};return t.desc=r.value.trim(),t.initiator=window.__page.user.id,t.pics="undefined"!=typeof i?i:[],s.execute({id:l,data:t}),!0}var t=nest.presentable(this),e=[],o=[];t.localIds=e,t.shareOrNot=!0,t.env="production"==__app.settings.env.NODE_ENV?"public":"web";var n=this.img_model=nest.modelable({},{url:__app.settings.api.url+"/img/"}),a=(this.model=nest.modelable({},{url:__app.settings.api.url+"/pa/"}),domain.action("multiupimgs4rnActivity")),s=domain.action("createRnActivity"),r=this.desc,l=util.getCookie("detailId");this.sendNote=function(){return t.localIds.length<=0&&""===r.value.trim()?(util.tipssuccess(1,"内容为空"),void 0):(util.forbidOperation_cp(),util.uploadtips("show","上传中,请稍后.."),p(e),void 0)}.bind(this),this.removeImg=function(i){t.localIds.splice(i.item.i,1)}.bind(this),this.shareOrNotToggle=function(){return t.shareOrNot?(t.shareOrNot=null,void 0):(t.shareOrNot=!0,void 0)}.bind(this);var d=function(){this.trigger("ready",!1),this.update(),this.trigger("ready",!0),this.trigger("view-route-to"),v()}.bind(t),c=function(){util.uploadtips("hide"),util.removeforbidOperation_cp(),t.shareOrNot?riot.route("activity/_"+l+"?share=true&guest=true"):riot.route("activity/_"+l+"?guest=true")},u=function(){util.uploadtips("hide"),util.tipssuccess(1,"失败,请查看您的网络"),util.removeforbidOperation_cp()};this.on("mount",function(){console.info("tag activities is mounted"),s.onDone(c),s.onFail(u)}),this.on("unmount",function(){console.info("tag activities is unmounted"),s.offDone(c),s.offFail(u)}),this.on("show",function(i){i&&__page.holder().setTitle("添加随记"),$(window).scrollTop(__page.holder().getTop())}),this.on("open",function(i){d(i),t.shareOrNot=!0,t.desc.value="",e=[],o=[],t.localIds=e,t.update(),wx.ready(function(){$("#filePicker").off("click").on("click",function(){wx.chooseImage({success:function(i){t.localIds=t.localIds.concat(i.localIds).slice(0,9),e=t.localIds,t.update()}})})}),$(window).scrollTop("0px")}),this.submitdraft=function(){riot.route("activity/_"+l)}.bind(this),this.showFootterNav=function(i){$(i.target).toggleClass("footer_navs_but_hover");var t=$(i.target).attr("class");t.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(200):$(".footer_navs_wary").slideDown(200),i.stopPropagation()}.bind(this);var v=function(){$(document).on("click",function(){$(".footer_navs_wary").slideUp(),$(".footer_navs_but").removeClass("footer_navs_but_hover")})},p=function(e){if(e.length<=0)return i();var s=e.pop();wx.uploadImage({localId:s,success:function(s){var r={name:util.getFileName(),mediaId:s.serverId};n.set("randomNotePic",r),n.save(),n.off("save").on("save",function(n){var s=a.newInvocation({id:l,resid:n._id});s.onDone(function(n){o.unshift(n),e.length>0?(t.update(),p(e)):i(o)}).onFail(function(){alert("upload note pic fail")}).execute()})}})}});
riot.tag("applications-item-initiator-sms",'<div class="applications-item" onclick="{checkboxSelect}"> <div class="div1"> <div> <div class="add_info_checkbox_div1" phone="{phone}" ></div> <img riot-src="{headImg}" width="24" class="imgradius"> {applicantName} </div> <div> <table class=""> <tr> <td class=" td1">{_displayName}</td> <td class=" td2">{num}人</td> </tr> </table> </div> </div> </div>',function(){var a=this,i=function(){return"production"==__app.settings.env.NODE_ENV?"public":"web"};a.env=i(),console.log("env="+a.env);var e=this.opts.tag.parent;a.tag=this.opts.tag,a.initiator=e.initiator,a.userId=e.userId,a.smsImg="/"+a.env+"/images/sms.png",a.telImg="/"+a.env+"/images/tel.png",a.appFields=__page.appFields,a.appFieldNameArr=Object.keys(a.appFields),a.moreOption=!1;for(var t=[],n=!1,l=0,p=a.appFieldNameArr.length;p>l;l++)"displayName"==a.appFieldNameArr[l]||"phone"==a.appFieldNameArr[l]?t.push(l):a.tag[a.appFieldNameArr[l]]&&!n&&(a.moreOption=!0,n=!0);for(var l=0,p=t.length;p>l;l++)a.appFieldNameArr.splice(t[l],1),t[l+1]=t[l+1]-1;var r=function(){var i=!1;return i=null==a.initiator?!1:null==a.userId?!1:a.initiator==a.userId?!0:!1};a.isNitiator=r();var s=function(){if(null==a.tag.applicant){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}if(null==a.tag.applicant.headImgUrl){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}return a.tag.applicant.headImgUrl};a.headImg=s();var d=function(){return 1==a.isNitiator?null!=a.tag.displayName?a.tag.displayName+"/"+a.tag.phone:a.tag.phone:""};a._displayName=d();var o=function(){return null==a.tag.applicant?"匿名":null==a.tag.applicant.displayName?"匿名":a.tag.applicant.displayName};a.applicantName=o(),this.checkboxSelect=function(a){$(a.currentTarget).find(".add_info_checkbox_div1").toggleClass("add_info_checked"),e._MassTextingURL()}.bind(this)});
riot.tag("applications-item-initiator",'<div class="applications-item" > <div class="div1"> <div onclick="{toggleMoreInfo}"><img riot-src="{headImg}" width="24" class="head-portrait"> {applicantName}</div> <div onclick="{toggleMoreInfo}"> <table> <tr> <td class="td1">{_displayName}</td> <td>{num}人</td> </tr> </table> </div> </div> <div class="clear"></div> <div class="div2 app_user_info"> <div if="{moreOption}"> <table class=""> <tr each = "{name, i in appFieldNameArr}" if="{parent[name]}"> <td class=" td1" valign="top">{parent.appFields[name].title}：</td> <td class=" td2">{parent[name]}</td> </tr> </table> </div> <div class="sms-tel"> <a href="sms:{phone}"><img riot-src="{smsImg}" class="vertical"> <span class="vertical">发短信</span></a> <a href="tel:{phone}"><img riot-src="{telImg}" class="vertical"> <span class="vertical">打电话</span> </a> </div> </div> </div>',function(){var a=this,i=function(){return"production"==__app.settings.env.NODE_ENV?"public":"web"};a.env=i(),console.log("env="+a.env);var t=this.opts.tag.parent;a.tag=this.opts.tag,a.initiator=t.initiator,a.userId=t.userId,a.smsImg="/"+a.env+"/images/sms.png",a.telImg="/"+a.env+"/images/tel.png",a.appFields=__page.appFields,a.appFieldNameArr=Object.keys(a.appFields),a.moreOption=!1;for(var e=[],n=!1,r=0,l=a.appFieldNameArr.length;l>r;r++)"displayName"==a.appFieldNameArr[r]||"phone"==a.appFieldNameArr[r]?e.push(r):a.tag[a.appFieldNameArr[r]]&&!n&&(a.moreOption=!0,n=!0);for(var r=0,l=e.length;l>r;r++)a.appFieldNameArr.splice(e[r],1),e[r+1]=e[r+1]-1;var p=function(){var i=!1;return i=null==a.initiator?!1:null==a.userId?!1:a.initiator==a.userId?!0:!1};a.isNitiator=p();var s=function(){if(null==a.tag.applicant){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}if(null==a.tag.applicant.headImgUrl){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}return a.tag.applicant.headImgUrl};a.headImg=s();var d=function(){return 1==a.isNitiator?null!=a.tag.displayName?a.tag.displayName+"/"+a.tag.phone:a.tag.phone:""};a._displayName=d();var o=function(){return null==a.tag.applicant?"匿名":null==a.tag.applicant.displayName?"匿名":a.tag.applicant.displayName};a.applicantName=o(),this.toggleMoreInfo=function(a){$(a.currentTarget).parent().parent().find(".app_user_info").toggle()}.bind(this)});
riot.tag("applications-item",'<div class="applications-item"> <div class="div1"> <div><img riot-src="{headImg}" width="24" class="head-portrait"> {applicantName}</div> <div style="text-align:right;"> {num}人 </div> </div> </div>',function(){var a=this,i=function(){return"production"==__app.settings.env.NODE_ENV?"public":"web"};a.env=i(),console.log("env="+a.env);var t=this.opts.tag.parent;a.tag=this.opts.tag,a.initiator=t.initiator,a.userId=t.userId;var n=function(){var i=!1;return i=null==a.initiator?!1:null==a.userId?!1:a.initiator==a.userId?!0:!1};a.isNitiator=n();var e=function(){if(null==a.tag.applicant){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}if(null==a.tag.applicant.headImgUrl){var i="/"+a.env+"/images/head.png";return console.log("headImg="+i),i}return a.tag.applicant.headImgUrl};a.headImg=e();var l=function(){return 1==a.isNitiator?null!=a.tag.displayName?a.tag.displayName+"/"+a.tag.phone:a.tag.phone:""};a._displayName=l();var r=function(){return null==a.tag.applicant?"匿名":null==a.tag.applicant.displayName?"匿名":a.tag.applicant.displayName};a.applicantName=r()});
riot.tag("communication-index",'<div if="{!hidden}"> <div class="communication-index" onclick="{showEdit}" name="{commenter.displayName}" replyuserid="{commenter._id}"> <div><img riot-src="{commenter.headImgUrl}" width="24" class="imgradius"></div> <div> <p class="p1"><span>{commenter.displayName}：</span>{replyString}<span>{replyToName}</span>{comment}</p> <p class="p2"> {time} <span>&nbsp;&nbsp;</span><a onclick="{deleteComment}" alt="{_id}" class="delete" if="{commenter._id == window.__page.user.id}">删除</a></p> </div> <div class="clear"></div> </div> </div>',function(){var e=this;e.env="production"==__app.settings.env.NODE_ENV?"public":"web",console.log("env="+e.env);var t=this.opts.tag.parent,a=this.opts.tag.parent._id,n=this.opts.tag.crtOn;e.replyString=""==this.opts.tag.replyTo?"":"回复 ";var i=domain.action("deleteActivityComment"),o=util.formatDate(n);e.time=o,e.update(),this.deleteComment=function(e){console.log(e);var n=$(e.target).attr("alt"),o=i.newInvocation({id:a,deleteId:n});o.onDone(function(e){t.comments=e,t.update()}).onFail(function(){alert("delete comment failed")}).execute(),e.stopPropagation()}.bind(this),this.showEdit=function(e){var a=$(e.currentTarget).parent().attr("class");if(a)t._resetFooterStyle();else{var n=$(e.currentTarget).attr("name"),i=$(e.currentTarget).attr("replyUserId"),o="";try{o=n?n:""}catch(e){o=""}t.replyToName=o,t.replyTo=i,$("#interflow_reply").val(""),$("#interflow_reply").attr("placeholder","回复 "+o+":"),$(".communication-index").parent().removeClass("com_wary_background_color"),$(e.currentTarget).parent().addClass("com_wary_background_color"),t.consult=1,t.update(),document.getElementById("interflow_reply").focus()}e.stopPropagation()}});
riot.tag("component-date",'<input type="text" id="{dateidtext}" value="00/00/00" readonly="readonly"> <input id="{dateid}" onchange="{datechange}" onclick="{dateclick}" onblur="{dateblur}" style="display: inline-block;margin-top:0px;" type="date">',function(){var t=nest.presentable(this);t.dateid=this.opts.dateid,t.datename=this.opts.datename,t.dateidtext=this.opts.dateidtext;var e=t.newdate=new Date(__page.servertime);t.on("toabsolute",function(){t.parent.btnbox.style.position="absolute",t.parent.btnbox.style.bottom="0px",t.parent.btnbox2.style.position="absolute",t.parent.btnbox2.style.bottom="0px"}),t.on("tofixed",function(){t.parent.btnbox.style.position="fixed",t.parent.btnbox.style.bottom="0px",t.parent.btnbox2.style.position="fixed",t.parent.btnbox2.style.bottom="0px"});var n=navigator.userAgent;n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(this.dateclick=function(){t.trigger("toabsolute")}.bind(this),this.dateblur=function(){t.trigger("tofixed")}.bind(this)),this.datechange=function(){var n=document.querySelector("#"+t.dateid),a=document.querySelector("#"+t.dateidtext);return""==n.value&&util.getBrowser().android===!1?(n.value=e,a.value=util.dateFormat(e,"yyyy/MM/dd"),!1):(a.value=util.dateFormat(new Date(n.value),"yyyy/MM/dd"),void 0)}.bind(this)});
riot.tag("debug-index",'<div class="view" if="{!hidden}"> <div> <button onclick="{refresh}">刷新</button> <button onclick="{back}">返回</button> <button onclick="{userInfo}">用户信息</button> <button onclick="{userReset}">重置用户</button> <button onclick="{userResetForChannel}">重置用户渠道信息</button> <a href="/auth/signout">注销</a>  <br> <a onclick="triggerClickMe();"> click me </a><br> <a id="clickMeLink" href="weixin://profile/gh_ad1cd17862c0" onclick="WeiXinAddContact(\'<span style=" background-color:#ff0000;"=""> click me </a><br>  <a id="clickLinkDirectlyLink" href="weixin://profile/gh_ad1cd17862c0" onclick="clickLinkDirectly();"> 直接点链接 </a><br>  <a id="followSeedTripLink" href="weixin://profile/gh_ad1cd17862c0" onclick="followSeedTrip"> 模拟点链接, 间接调用方法 </a><br>  <a href="weixin://profile/gh_ad1cd17862c0" onclick="triggerFollowMe();"> 模拟点链接, 直接调用方法 </a><br> <a id="followMeLink" href="weixin://profile/gh_ad1cd17862c0" onclick="WeiXinAddContact();"> 模拟点链接, 直接调用方法 </a><br>   </div> 页面用户信息： <div id="user"> </div> 存储用户信息： <div id="userLoaded"> </div> COOKIE信息 <div id="cookie"> </div> </div>',function(){function e(e,i){return"undefined"==typeof WeixinJSBridge?(alert("WeixinJSBridge undefined"),!1):"undefined"==typeof WeixinJSBridge.invoke?(alert("WeixinJSBridge.invoke undefined"),!1):(WeixinJSBridge.invoke("addContact",{webtype:"1",username:e},function(e,n){alert(e.err_code),alert(e.err_msg),alert(n),i&&i(e.err_msg)}),void 0)}var i=nest.presentable(this);i.env=__app.settings.env.NODE_ENV,console.log("env="+i.env);var n=function(){i.trigger("view-route-to")},t=function(){i.update(),i.trigger("show",!0)};this.on("mount",function(){console.info("tag debug is mounted")}),this.on("open",function(){console.info("tag debug is opening"),n()}),this.on("refresh",function(){console.info("tag debug is refreshing"),t()}),this.on("show",function(e){e&&__page.holder().setTitle("调试页面")}),this.refresh=function(){t()}.bind(this),this.back=function(){i.trigger("view-route-back")}.bind(this),this.userInfo=function(){$("#user").html(JSON.stringify(__page.user)),$("#cookie").html("token: "+$.cookie("token")+"<br>agent: "+$.cookie("agent")+"<br>connect.sid: "+$.cookie("connect.sid")),__page.user.id&&$.getJSON(__app.settings.api.url+"/user/_"+__page.user.id).done(function(e){$("#userLoaded").text(JSON.stringify(e.result))}).fail(function(e,i,n){$("#userLoaded").text(JSON.stringify(n))})}.bind(this),this.userReset=function(){$.cookie("token",null,{path:"/"}),$.cookie("agent",null,{path:"/"})}.bind(this),this.userResetForChannel=function(){$.get(__app.settings.api.url+"/user/resetUserForChannel",function(e){alert(e)})}.bind(this),this.follow=function(){e("gh_ad1cd17862c0",function(e,i){alert(e),alert(i)})}.bind(this)});
riot.tag("highlights-desc","<span></span>",function(){this.root.innerHTML=""==this.opts.content?"&nbsp;":this.opts.content});
riot.tag("initactivity-menu",' <div class="xcgyimg xcgy_gz setwzcss border_radius" id="focus_on"><a href="/index#activity/new"> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/c_04.png" class="border_radius"></a></div>',function(){self=this,self.env=__app.settings.env.NODE_ENV,console.log("env="+self.env)});
riot.tag("introduce-item","<p>{name}</p>",function(){});
riot.tag("mask-loading",'<div> <div class="container" riot-style="height:{winheight}"> <div class="mask_loading" > <div></div> <div></div> <p>小种子努力加载中...</p> </div> </div> </div>',"mask-loading { } mask-loading .container{ width:100%; height:100%; min-height:567px; }",function(){var i=nest.presentable(this);i.env=__app.settings.env.NODE_ENV,this.winheight=window.innerHeight+"px",this.on("mount",function(){}),this.show=this.opts.show});
riot.tag("mine-index",'<div if="{!hidden}"> <mask-loading show="{mask}"></mask-loading> <div if="{!mask}"> <div class="mine-top-bar-placeholder"></div> <div class="mine-top-bar"> <div class="mine_nav"> <div class="{mine_bar_checked == 1 ? \'checked\' : \'\'}" alt="1" onclick="{minenav}">参与的活动</div> <div class="{mine_bar_checked == 2 ? \'checked\' : \'\'}" alt="2" onclick="{minenav}">发布的活动</div> <div class="{mine_bar_checked == 3 ? \'checked\' : \'\'}" alt="3" onclick="{minenav}">收藏的活动</div> </div> </div> <div class="clear"></div> <div class="activity-list" id="attendee" if="{mine_bar_checked == 1}"> <activity-item class="activity-item" each="{items2}" curritem="{this}"></activity-item> </div> <div class="activity-list" id="initiator" if="{mine_bar_checked == 2}"> <activity-item class="activity-item" each="{items}" curritem="{this}"></activity-item> </div> <div class="activity-list" id="minelike" if="{mine_bar_checked == 3}"> <activity-item class="activity-item" each="{items3}" curritem="{this}"></activity-item> </div>  <div class="footer_placeholder"></div> <div class="footer-index setleft"> <div> <a href="#activity/index"><i><img riot-src="/{env}/images/footer_nav_activity1.png"><br>活动</i></a> <a href="#travel/index"><i><img riot-src="/{env}/images/footer_nav_travel1.png"><br>场所</i></a> <a href="#mine/index"><i class="current"><img riot-src="/{env}/images/footer_nav_mine2.png"><br>我的</i></a> </div> <div> <i onclick="{showattention}">发布活动</i> </div> </div> </div> </div>',function(){function i(){var i=Math.round(360*$("#wary").width()/640);$(".img1").css("height",i+"px")}var t=nest.presentable(this);t.env="production"==__app.settings.env.NODE_ENV?"public":"web",t.load=0;var e=this.collection=nest.collectable({},{url:__app.settings.api.url+"/pa/initiated",filter:this.opts.filter}),s=this.collection2=nest.collectable({},{url:__app.settings.api.url+"/pa/applied",filter:this.opts.filter}),a=this.collection3=nest.collectable({},{url:__app.settings.api.url+"/pa/stard",filter:this.opts.filter});this.filter=this.opts.filter,e.on("fetch",function(i){console.info("activities is fetched"),t.items=i,t.load>=2?(t.update(),t.trigger("show",!0),t.trigger("ready",!0),t.trigger("view-route-to"),r()):t.load=t.load+1}),s.on("fetch",function(i){console.info("activities is fetched 2"),t.items2=i,t.load>=2?(t.update(),t.trigger("show",!0),t.trigger("ready",!0),t.trigger("view-route-to"),r()):t.load=t.load+1,c()}),a.on("fetch",function(i){console.info("activities is fetched 3"),t.items3=i,t.mine_bar_checked=1,t.load>=2?(t.update(),t.trigger("show",!0),t.trigger("ready",!0),t.trigger("view-route-to"),r()):t.load=t.load+1});var o=function(i){this.trigger("ready",!1),this.filter=i||this.filter,t.load=0,e.fetch({filter:this.filter}),s.fetch({filter:this.filter}),a.fetch({filter:this.filter}),$("#wary").css({height:"auto",overflow:"visible"}),$("body").css({height:"auto",overflow:"visible"})}.bind(t),n=function(){this.trigger("ready",!1),t.load=0,e.fetch({filter:this.filter}),s.fetch({filter:this.filter}),a.fetch({filter:this.filter})}.bind(t);this.on("mount",function(){console.info("tag activities is mounted")}),this.on("open",function(i){console.info("tag activities is opening"),o(i)}),this.on("leave",function(){t.mask=!0,t.update()}),this.on("reenter",function(){t.mask=!1,t.update()}),this.on("show",function(i){i&&__page.holder().setTitle("我的"),$(window).scrollTop("0px")}),this.on("refresh",function(){console.info("tag activities is refreshing"),n()}),this.refresh=function(){n()}.bind(this);var r=function(){i()};this.showattention=function(){riot.route("activity/new")}.bind(this);var c=function(){$(document).click(function(){$(".home_gy_set")&&($(".home_gy").removeClass("home_gy_set"),$(".home_gy").addClass("home_gy_set1"))}),$(".img_home").click(function(i){$(".home_gy").removeClass("home_gy_set1"),$(".home_gy").addClass("home_gy_set"),i.stopPropagation()})};$(window).resize(function(){i()}),this.showFootterNav=function(i){$(i.target).toggleClass("footer_navs_but_hover");var t=$(i.target).attr("class");t.indexOf("footer_navs_but_hover")<0?$(".footer_navs_wary").slideUp(200):$(".footer_navs_wary").slideDown(200),i.stopPropagation()}.bind(this),this.minenav=function(i){var e=$(i.target).attr("alt");t.mine_bar_checked=e,t.update()}.bind(this)});
riot.tag("navigator",'<div if="{show}">  <div class="home_gy" style="bottom:28px;"> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/home.png" class="border_radius img_home"> <a href="#activity/index"><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/home_nav1.png" class="home_nav"></a> <a href="#travel/index"><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/home_nav2.png" class="home_nav"></a> <a href="#mine/index"><img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/home_nav3.png" class="home_nav"></a> <img riot-src="/{env==\'production\'?\'public\':\'web\'}/images/home_close.png" class="home_close"> </div> </div>',function(){self=this,this.show=!0,self.env=__app.settings.env.NODE_ENV,console.log("env="+self.env)});
riot.tag("randomnotes-item",'<div class="randomnotes-item"> <div class="fl" ><img src= "{initiator.headImgUrl || \'/public/images/head.png\'}" width="24" style="border-radius: 50em"></div> <div class="fl"> <div> <span>{initiator.displayName}：</span> <p onclick="{ shareinfo }"><img riot-src="/{env}/images/share_but.png" class=""> <span class="vertical"> 分享</span></p> </div> <p>{desc}</p> <div class="trave_img_wary"> <p each="{ pics }" ><img riot-src="{ parent.parseImg(meta, url) }" onclick="{parent.previewImg}" standard="{meta}"></p> </div> <p class="p2">{time} <a onclick="{deleteRandomNote}" alt="{_id}" class="delete" if="{initiator._id == window.__page.user.id}">删除</a></p> </div> <div class="clear"></div> </div>',function(){var e=this;e.env="production"==__app.settings.env.NODE_ENV?"public":"web";var t=domain.action("delRnActivity"),i=this.opts.tag.parent;e.currentRandomNote=e.opts.tag;var a=this.opts.tag.parent._id,n=this.opts.tag.crtOn,s=util.formatDate(n);e.time=s,e.parseImg=function(e,t){var i={meta:e,url:t};return util.parseImgUrl(i)},this.on("mount",function(){t.onDone(function(e){i.randomNotes=e,i.update()})}),this.previewImg=function(){e.currentRandomNote&&e.currentRandomNote.pics&&e.currentRandomNote.desc?util.wedgt.imgPreviewer($("#wary"),e.currentRandomNote.pics,{msg:e.currentRandomNote.desc}):e.currentRandomNote&&e.currentRandomNote.pics&&util.wedgt.imgPreviewer($("#wary"),e.currentRandomNote.pics,{msg:""})}.bind(this),this.deleteRandomNote=function(e){var i=$(e.target).attr("alt");t.execute({id:a,deleteId:i}),e.stopPropagation()}.bind(this),this.shareinfo=function(){var e,t,i,a,n=this,s=this.parent.parent;if(s.shareinfo_detail(),n&&n.pics[0]&&n.pics[0]){var r={};r.images=[],r.images[0]={meta:n.pics[0].meta,url:n.pics[0].url},e="http://"+util.sharepic(r)}else e="/public/images/pabanner.png";t={title:'我在参加"'+s.item.name+'"活动,给小伙伴直播一下~~~~',desc:n.desc||s.item.name,link:__page.holder().getBaseUrl()+"/index#activity/_"+s._id+"?guest="+n._id,imgUrl:e},i=Object.create(t),i.success=function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",s.item.name+"随记"||"",util.convertToValue(s.item.tags.type).join(",")||"",0])},a=Object.create(t),a.success=function(){_czc.push(["_trackEvent",util.getDc().PA.NAME+"("+util.getDc().PA.ACTION.SHARE+")",s.item.name+"随记"||"",util.convertToValue(s.item.tags.type).join(",")||"",0])},wx.onMenuShareAppMessage(i),wx.onMenuShareTimeline(a)}.bind(this)});
riot.tag("travel-detail",'<div if="{!hidden}" class="travel-detail"> <div id="wary"> <div class="travel-detail-screen"> <img riot-src="{picshow}" class="img1"> <div class="scr tt_setheight_line"> <div class="scr_left">{item.name}</div> <div class="scr_right"><img src="/public/images/3_03.png"> <span class="likesum">{item.meta.likes}</span></div> </div> <div class="shadow tt_setheight"></div> </div> <div class="pun t-c set_width2"> {item.promotionWords} </div> <div class="pub_tit t-c m_top10"> 亮点 </div> <ul class="ld_ul1"> <li each="{ i in highlightsArray }">• {i}</li> </ul> <div class="pub_tit t-c m_top10"> 概览 </div> <div class="pun m_top10 set_width1"> {item.summary} </div> <div class="pub_tit t-c m_top10"> 介绍 </div> <div class="introduce nav_info"> <div class="detail_pub m_top10" each="{element,i in item.elements }"> <p class="FB"><img src="/public/images/3_01.png" class="img_width vertical"> <span class="vertical" >{i+1}.{element.name}</span></p> <travel-spot each="{element.spots}"></travel-spot> </div> <div class="xcgyimg border_radius xcgy_gz" id="showCatalog" onclick="{showcatalogue}"> <img src="/public/images/3_09.png" class="border_radius"> </div> </div> <div class="comment display_none nav_info" id="commentId"></div> <div class="detail_pub m_top10 position_rel border_radius_3px"> <a href="http://mp.weixin.qq.com/s?__biz=MzA3MjIwNTk4Mg==&mid=204371161&idx=1&sn=51f61cc7634389147a7050a5a2e97a6f#rd" class="butA"><img src="../public/images/guanzhu.jpg" alt="提示" class="border_radius_3px"> </a> </div>  <div class="footer_placeholder"></div> <div class="footer"> <div onclick="{returnPage}"></div> <div class="but1 button travel-detail-live" onclick="{live}"></div> <div class="button but2" onclick="{shareinfo}">分享</div> </div> <div class="footer_shadow"></div> <div class="body_shadow display_none" onclick="{hideShadow}"></div> <div class="xcgy_wary display_none"> <div class="xcgy_wary_div1">介绍目录</div> <div class="xcgy_wary_div2"> <ul> <li each="{element,i in item.elements}"><p></p>{i+1}.{element.name} </li> </ul> </div> </div> <div class="comments_wary display_none border_radius"> <img src="/public/images/close.png" class="but_close_img"> <div class="comm_cz_sbss">随便说说</div> <textarea class="textarea border_radius"></textarea> <button class="comm_but border_radius">提交</button> </div> <div class="together display_none" id="clickXHidden" onclick="{hideShadow}"> <img src="/public/images/4_02.png" class="together_img"> </div> <wechat-menu if="{!subscribe}"></wechat-menu> </div> </div>',function(){var i=nest.presentable(this);i.env=__app.settings.env.NODE_ENV;var e=nest.modelable({},{url:__app.settings.api.url+"/tt/"});i.footershow=!0,e._id=this._id=this.opts._id,e.on("fetch",function(e){console.info("activity is fetched"),i.item=e,i.id=e._id,i.name=e.name,i.promotionWords=e.promotionWords,i.highlightsArray=e.highlights.split("\r\n"),console.log(e.highlights),i.userId=window.__page.user.id,i.user=JSON.stringify(window.__page.user),i.picshow=util.calcImageUrl(i.item),i.likes=e.meta.likes,i.subscribe=1==__page.user.wx_subscribe?!0:!1,i.update({item:e}),i.trigger("ready",!0),i.trigger("view-route-to"),a(),d(),o()});var s=function(i){this.trigger("ready",!1),this._id=i||this._id,e.set("_id",this._id),e.fetch({action:"open"})}.bind(i),t=function(){this.trigger("ready",!1),e.fetch(this._id,{action:"refresh"})}.bind(i);this.on("mount",function(){console.info("tag activity is mounted")}),this.on("open",function(i){console.info("tag activity is opening"),s(i)}),this.on("refresh",function(){console.info("tag activity is refreshing"),t()}),this.on("show",function(e){e&&__page.holder().setTitle(i.item.name),$(window).scrollTop("0px")});var a=function(){var e=__page.user.meta.likes[i.id];e?$(".footer .but1").removeClass("travel-detail-live").addClass("travel-detail-live1"):$(".footer .but1").removeClass("travel-detail-live1").addClass("travel-detail-live")},o=function(){$(document).click(function(){$(".home_gy_set")&&($(".home_gy").removeClass("home_gy_set"),$(".home_gy").addClass("home_gy_set1"))}),$(".img_home").click(function(i){$(".home_gy").removeClass("home_gy_set1"),$(".home_gy").addClass("home_gy_set"),i.stopPropagation()})};this.returnPage=function(){riot.route("travel/index")}.bind(this),this.live=function(){$.ajax({type:"GET",url:__app.settings.api.url+"/tt/_"+i.id+"/like",success:function(s){s.status&&(s.result>i.likes?__page.user.meta.likes[i.id]="11111":delete __page.user.meta.likes[i.id],e.fetch())}})}.bind(this),this.shareinfo=function(){var i=$(window).scrollTop(),e=$(window).height(),s=$("body").height(),t=e>s?e:s;$(".together").show().css("top",i+"px"),$(".body_shadow").show().css("height",t+"px")}.bind(this),this.showcatalogue=function(){var i=$(window).scrollTop(),e=$(window).height(),s=$("body").height(),t=e>s?e:s;$(".body_shadow").show().css("height",t+"px"),$(".xcgy_wary").show().css("top",i+20+"px")}.bind(this),this.hideShadow=function(){$(".body_shadow").hide(),$(".xcgy_wary").hide(),$(".comments_wary").hide(),$(".together").hide()}.bind(this);var d=function(){wx.ready(function(){wx.onMenuShareAppMessage({title:i.name,desc:i.promotionWords,link:__page.holder().getBaseUrl()+"/index#travel/_"+i.id,imgUrl:i.picshow,type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:i.name,link:__page.holder().getBaseUrl()+"/index#travel/_"+i.id,imgUrl:i.picshow,success:function(){},cancel:function(){}})})}});
riot.tag("travel-index",'<div if="{!hidden}"> <div class="clear">&nbsp</div> <div class="activity-list"> <travel-item each="{items}" curritem="{this}" class="activity-item travel-item"></travel-item> </div> <wechat-menu if="{!subscribe}"></wechat-menu>  <div class="footer_placeholder"></div> <div class="footer-index setleft"> <div> <a href="#activity/index"><i><img riot-src="/{env}/images/footer_nav_activity1.png"><br>活动</i></a> <a href="#travel/index"><i class="current"><img riot-src="/{env}/images/footer_nav_travel2.png"><br>场所</i></a> <a href="#mine/index"><i><img riot-src="/{env}/images/footer_nav_mine1.png"><br>我的</i></a> </div> <div> <i onclick="{showattention}">发布活动</i> </div> </div> </div>',function(){function i(){var i=Math.round(260*Math.round(.95*$("#wary").width())/600)-3;$(".img1").css("height",i+5)}var e=nest.presentable(this);e.env="production"==__app.settings.env.NODE_ENV?"public":"web";var t={sort:{updOn:-1},conditions:{}},n=this.collection=nest.collectable({},{url:__app.settings.api.url+"/tt/filter",filter:t});n.on("fetch",function(i){console.info("activities is fetched"),e.items=i,e.subscribe=1==__page.user.wx_subscribe?!0:!1,e.update(),e.trigger("ready",!0),e.trigger("view-route-to"),r(),a()});var o=function(i){this.trigger("ready",!1),this.filter=i||this.filter,n.fetch({filter:this.filter})}.bind(e),s=function(){this.trigger("ready",!1),n.fetch({filter:this.filter})}.bind(e);this.on("mount",function(){console.info("tag activities is mounted")}),this.on("open",function(i){console.info("tag activities is opening"),o(i)}),this.on("refresh",function(){console.info("tag activities is refreshing"),s()}),this.on("show",function(i){i&&__page.holder().setTitle("场所"),$(window).scrollTop("0px")}),this.refresh=function(){s()}.bind(this);var r=function(){i()};$(window).resize(function(){i()});var a=function(){$(document).click(function(){$(".home_gy_set")&&($(".home_gy").removeClass("home_gy_set"),$(".home_gy").addClass("home_gy_set1"))}),$(".img_home").click(function(i){$(".home_gy").removeClass("home_gy_set1"),$(".home_gy").addClass("home_gy_set"),i.stopPropagation()})};this.showattention=function(){riot.route("activity/new")}.bind(this),wx.ready(function(){wx.onMenuShareAppMessage({title:"快乐种子",desc:"欢迎关注快乐种子，更多精彩活动等你参加！",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"快乐种子",link:__page.holder().getBaseUrl()+"/index#activity/index",imgUrl:__page.holder().getBaseUrl()+"/public/images/logo.png",success:function(){},cancel:function(){}})})});
riot.tag("travel-item",'                  <div class="screen"> <a href="#travel/_{_id}"><img riot-src="{picshow}" class="activity-cover-img img1"></a> <div class="bottom-bar"> <div> <p>{name.length > 15 ? name.substring(0, 15)+\'...\':name}</p> <p> <span></span>{promotionWords.length > 16 ? promotionWords.substring(0, 16)+\'...\':promotionWords} </p> </div> <div><img src= "{path}"> <span>{likes}</span></div> </div> <div class="shadow"></div> </div>',function(){var i=this.opts.curritem,s=this,e=__page.user;s.env=__app.settings.env.NODE_ENV;var t="development"==s.env?"web":"public";s.picshow=util.calcImageUrl(i),s.likes="0",s.path="";var a=function(){if(e.id){var a=e.meta.likes[i._id];a?(s.path="/"+t+"/images/3_06_h.png",s.likes=i.meta.likes):(s.path="/"+t+"/images/3_03.png",s.likes=i.meta.likes)}else s.path="/"+t+"/images/3_03.png",s.likes=i.meta.likes;console.log(s.path)};this.on("mount",function(){console.info("tag activities is mounted"),a(),this.update()})});
riot.tag("travel-spot",'<p each="{pic in pics}"> <img riot-src="{pic}" class="activity-cover-img img1 border_radius"> </p> <p>{desc}</p>',function(){});
riot.tag("wechat-menu",'<div class="wechat-menu" id="focus_on"> <img riot-src="/{env}/images/logo_1.png"> </div> <a href="{wxhref}"><div class="xcgyimg_flash xcgyimg_1"></div></a>',function(){self=this;var e=function(){return"production"==__app.settings.env.NODE_ENV?"public":"web"};self.wxhref=util.getWxhref(),self.env=e()});}